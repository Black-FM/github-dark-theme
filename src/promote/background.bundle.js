!function(e){var t={};function n(a){if(t[a])return t[a].exports;var r=t[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(a,r,function(t){return e[t]}.bind(null,r));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=34)}({34:function(e,t,n){"use strict";n.r(t);n(35),n(36),n(37),n(38);async function a(e){if("anima"===window.extensionName&&window.userData){const e=window.userData&&window.userData.email?window.userData.email:"";e?chrome.runtime.setUninstallURL(`${window.API_PROJECT}/chrome-extension-uninstall?email=${e}`):chrome.runtime.setUninstallURL(window.API_PROJECT+"/chrome-extension-uninstall")}}window.userLogin=!1,window.mainButton="code",window.extensionName=null,window.userData,window.access_token,chrome.runtime.onMessage.addListener((e,t,n)=>("sendApi"==e.api?async function(e,t,n="GET",a,r=!1,o){let s=t&&"projects"===t.baseUrl?window.API_PROJECT:window.API_URL;a&&"localhost"===a.baseUrl&&(s="http://localhost:5007");const i=r?e:`${s}${e}`;t&&t.baseUrl&&delete t.baseUrl;const c={method:n,headers:a,body:t?JSON.stringify(t):null};let l=await fetch(i,c);if(200==l.status){if(a&&a.toText){return await l.text()}return await l.json()}return{error:await l.json()}}(e.url,e.data,e.method,e.header,e.overwriteUrl).then(e=>{n(e)}):"logout"===e.api?(window.userData=null,window.access_token=null,chrome.tabs.getAllInWindow(e=>{e.map(e=>{chrome.tabs.sendMessage(e.id,{message:"logout"},null,()=>{})})})):"loadFeatureFlag"===e.api?(window.mainButton=e.mainButton,window.extensionName=e.extensionName,a()):"userLogin"===e.api?(window.userLogin=e.isLogin,a()):"updateUserCache"===e.api&&(window.userData=e.userData,window.access_token=e.access_token,a()),!0)),chrome.runtime.onInstalled.addListener((function(e){chrome.tabs.query({currentWindow:!0},(function(e){const t=chrome.runtime.getManifest().content_scripts[0].js[0];for(let n=0;n<e.length;n++)chrome.tabs.executeScript(e[n].id,{file:t},e=>{})}))}));chrome.tabs.onUpdated.addListener((e,t,n)=>{console.log("changeInfo.status",t.status),"complete"===t.status&&n.url.includes("figma.com")&&chrome.tabs.executeScript(e,{file:"app.bundle.js"},()=>{})})},35:function(e,t){window.API_URL="https://api.animaapp.com",window.API_PROJECT="https://projects.animaapp.com"},36:function(e,t){var n=!1;let a,r=null;chrome.runtime.onMessage.addListener((e,t,s)=>{if("getFigmaDesignFromAnima"===e.api){r=t.tab.id,n=!1,clearTimeout(a),a=setTimeout(()=>{n=!0},36e4),t&&t.tab&&t.tab.id&&o.push(t.tab.id);let i=e.data,c=e.accessToken;i.fileId;(async function(e,t){const a={method:"POST",headers:{"Content-Type":"application/json",Authorization:t="JWT "+t},body:JSON.stringify(e)};let r;try{r=await fetch("https://figma-service.animaapp.com/generate/async",a)}catch(e){console.error(e)}if(200==r.status||201==r.status){n=!1;let e,a=await r.json();try{e=await async function e(t){let a=await async function(e,t){const n={method:"POST",headers:{"Content-Type":"application/json",Authorization:e.accessToken},body:JSON.stringify(e)};let a;try{a=await fetch("https://figma-service.animaapp.com/task/callback",n)}catch(e){console.error(e)}if(400===a.status)return a;if(200===a.status)return a;if(204===a.status)return chrome.tabs.getAllInWindow(e=>{e.map(e=>{chrome.tabs.sendMessage(e.id,{to:"AnimaStore",message:"add-percentage"},null,()=>{})})}),new Promise(e=>{setTimeout(()=>{e(a)},2e3)})}(t);if(a.error)return a;if(400===a.status)return a=await a.json(),a;if(204===a.status&&!n)return await e(t);if(200===a.status){return function(e){let t=e.project_short_id,n=e.homepage_slug,a=e.short_id;return`http://projects.animaapp.com/p/${t}/${a}/${n}/syncwebsite?extensionName=${window.extensionName}`}(await a.json())}if(n)return{error:"Error: convert Figma file to design failed"}}({taskId:a.taskId,accessToken:t})}catch(e){return{error:"Error: convert Figma file to design failed"}}if(e.error)return e;let o=e.replace("projects.","canary-projects.").replace("prototype","omniview"),s=e.replace("projects.animaapp.com","localhost:5002").replace("prototype","omniview").replace("https","http"),i=e.replace("prototype","omniview");return console.log("canaryUrl",o),console.log("localhostUrl",s),console.log("prodUrl",i),window.API_PROJECT.includes("https://projects.animaapp.com")?i:o}return 400===r.status?(r=await r.json(),{error:r.message}):{error:"Error: async design failed"}})(i,c).then(e=>{clearTimeout(a),e&&setTimeout(()=>{s(e)},2e3)})}return!0});let o=[]},37:function(e,t){let n,a=!1,r=[];chrome.runtime.onMessage.addListener((e,t,a)=>{let c={platform:"figma",to:e.type?e.type:"login"};return"getLoginUrl"===e.api?(t&&t.tab&&t.tab.id&&r.push(t.tab.id),clearTimeout(n),n=setTimeout(()=>{clearInterval(this.intervalInstance)},18e4),i(null,c,e.dontAddSource).then(e=>{a(e)})):"getFigmaAccessToken"===e.api?o(e.body,e.access_token):"checkIfWeHaveStorageUser"===e.api?a({userData:window.userData,access_token:window.access_token}):"getUserAfterLogin"===e.api&&l(e.data.pairingToken,c).then(e=>{t&&t.tab&&t.tab.id&&r.push(t.tab.id);let n={headers:{"X-Client-Id":"com.animaapp.figma","X-Client-Version":"0.0.1",Authorization:"JWT "+e.access_token}};s(n).then(t=>{window.userData=t,window.access_token=e.access_token,a({user:t,access_token:e.access_token})})}),!0});const o=async(e,t)=>{const n=window.API_URL+"/figma_token/generate",a={method:"POST",headers:{"Content-Type":"application/json","X-Client-Id":"com.animaapp.figma","X-Client-Version":"0.0.1",Authorization:"JWT "+t},body:e};await fetch(n,a)},s=async e=>{const t=window.API_URL+"/users/me",n={method:"GET",headers:{"Content-Type":"application/json"}};e.headers&&(n.headers=Object.assign(n.headers,e.headers));let a=await fetch(t,n);if(200==a.status){return await a.json()}{console.log("ERROR GETTING CURRENT USER > ",a);let e=await a.json();if(e.error){let t=new Error(e.description||"Something went wrong!");throw t.statusCode=e.status_code||a.status||500,t.error=e.error||"Error",t}{let e=new Error("Something went wrong!");throw e.statusCode=a.status||500,e.error="Error",e}}},i=async(e,t={},n)=>{try{if(!e){e=(await c(t)).token}let a=`${window.API_PROJECT}/${t&&t.to&&"signup"===t.to?"signup":"login"}?pairing=true&pt=${e}&platform=${t.platform}`;return t&&(a+=n||`&platform=${t.platform}&utm_medium=plugin&utm_source=figma&utm_content=signup-button`),{url:a,pairingToken:e}}catch(e){throw console.log("ERROR > GETTING BROWSER LOGIN URL > ",e),e}},c=async(e={})=>{try{a=!1;const t=window.API_URL+"/rpc/generate_pairing_token",n={method:"POST",headers:{"Content-Type":"application/json"}};e.headers&&(n.headers=Object.assign(n.headers,e.headers));let r=await fetch(t,n);if(200==r.status){return await r.json()}let o=await r.json();if(o.error){let e=new Error(o.description||"Something went wrong!");throw e.statusCode=o.status_code||r.status||500,e.error=o.error||"Error",e}{let e=new Error("Something went wrong!");throw e.statusCode=r.status||500,e.error="Error",e}}catch(e){throw console.log("ERROR > GENERATING PAIRING TOKEN > ",e),e}},l=async(e,t={})=>new Promise(async(n,r)=>{try{if(!e){let n=await this.generatePairingToken(t);e=n.token}const o=async()=>{try{let a=await u(e,t);a.result&&"ok"==a.result&&(clearInterval(this.intervalInstance),n(a))}catch(e){console.error("ERROR > GETTING ACCESS TOKEN > "),clearInterval(this.intervalInstance),r(e)}};a||(this.intervalInstance=setInterval(o,2e3))}catch(e){console.log("ERROR > GETTING ACCESS TOKEN > ",e),r(e)}}),u=async(e,t={})=>{try{const n=`${window.API_URL}/rpc/pairing_token?t=${e}`,a={method:"GET",headers:{"Content-Type":"application/json"}};t.headers&&(a.headers=Object.assign(a.headers,t.headers));let r=await fetch(n,a);if(200==r.status){return await r.json()}let o=await r.json();if(o.error){let e=new Error(o.description||"Something went wrong!");throw e.statusCode=o.status_code||r.status||500,404==e.statusCode&&(e.message="Failed to pair. Please try again!"),e.error=o.error||"Error",e}{let e=new Error("Something went wrong!");throw e.statusCode=r.status||500,404==e.statusCode&&(e.message="Failed to pair. Please try again!"),e.error="Error",e}}catch(e){throw console.log("ERROR > GENERATING AUTH URL > ",e),e}};function d(e){r.find(t=>t===e)&&clearInterval(this.intervalInstance)}chrome.tabs.onRemoved.addListener(e=>{d(e)}),chrome.tabs.onUpdated.addListener(e=>{d(e)})},38:function(e,t){let n=!1;function a(e,t,n,a={}){var o={eventCategory:"General",eventAction:e||"",uid:r};a.extensionName=window.extensionName,o.params=JSON.stringify(a);var s=function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t.length>0&&(t+="&"),t+=encodeURI(n+"="+e[n]));return t}(o),i=new XMLHttpRequest;i.open("POST","https://logs.animaapp.com/analytics/collect",!0),i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.setRequestHeader("X-User-Email",n||""),i.setRequestHeader("X-Client-Id","com.animaapp.chrome.extension"),i.setRequestHeader("X-Client-Version","1.0.0"),i.send(s)}chrome.runtime.onMessage.addListener((e,t,s)=>{if("trackEvent"===e.api){if(t&&t.origin&&"string"==typeof t.origin&&t.origin.includes(".figma.")){let t=e.params?e.params:{};a(e.eventName,e.userId,e.userEmail,t)}}else"firstRefresh"===e.api?(r=e.UUID,n&&(n=!1,setTimeout(()=>{a("chrome.extension.installed","","")},5e3))):"alias"===e.api&&async function(e,t){if(r&&e){const n={alias:e,distinct_id:r};try{let a="https://logs.animaapp.com/analytics/register_alias";await function(e,t,n,a){return new Promise((r,s)=>{const i=o(t),c=new XMLHttpRequest;c.open("POST",e,!0),c.setRequestHeader("Content-type","application/x-www-form-urlencoded"),c.setRequestHeader("X-User-Id",n||""),c.setRequestHeader("X-User-Email",a||""),c.setRequestHeader("X-Client-Id","com.animaapp.chrome.extension"),c.setRequestHeader("X-Client-Version","1.0.0");for(const e in this.headers){const t=this.headers[e];c.setRequestHeader(e,t)}c.onreadystatechange=function(){4===c.readyState&&200===c.status?s(c.response):r({status:c.status,statusText:c.statusText})},c.onerror=function(){r({status:c.status,statusText:c.statusText})},c.send(i)})}(a,n,e,t)}catch(e){console.log("register_alias failed",e)}}}(e.userId,e.email);return!0});let r=null;chrome.runtime.onInstalled.addListener((function(e){"install"==e.reason&&(n=!0)}));const o=e=>{let t="";for(let n in e)e.hasOwnProperty(n)&&(t.length>0&&(t+="&"),t+=encodeURI(n+"="+e[n]));return t}}});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL2JhY2tncm91bmQvYmFja2dyb3VuZC5qcyIsIndlYnBhY2s6Ly8vLi9zcmMvYmFja2dyb3VuZC9iYWNrZ3JvdW5kQ29uZmlnRmlsZS5qcyIsIndlYnBhY2s6Ly8vLi9zcmMvYmFja2dyb3VuZC9iYWNrZ3JvdW5kR2V0RmlnbWFQcmV2aWV3LmpzIiwid2VicGFjazovLy8uL3NyYy9iYWNrZ3JvdW5kL2JhY2tncm91bmRMb2dpbi5qcyIsIndlYnBhY2s6Ly8vLi9zcmMvYmFja2dyb3VuZC9iYWNrZ3JvdW5kVHJhY2tpbmcuanMiXSwibmFtZXMiOlsiaW5zdGFsbGVkTW9kdWxlcyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImV4cG9ydHMiLCJtb2R1bGUiLCJpIiwibCIsIm1vZHVsZXMiLCJjYWxsIiwibSIsImMiLCJkIiwibmFtZSIsImdldHRlciIsIm8iLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJnZXQiLCJyIiwiU3ltYm9sIiwidG9TdHJpbmdUYWciLCJ2YWx1ZSIsInQiLCJtb2RlIiwiX19lc01vZHVsZSIsIm5zIiwiY3JlYXRlIiwia2V5IiwiYmluZCIsIm4iLCJvYmplY3QiLCJwcm9wZXJ0eSIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwicCIsInMiLCJhc3luYyIsImxvYWRVbmluc3RhbGxQYWdlIiwiZW1haWwiLCJ3aW5kb3ciLCJleHRlbnNpb25OYW1lIiwidXNlckRhdGEiLCJjaHJvbWUiLCJydW50aW1lIiwic2V0VW5pbnN0YWxsVVJMIiwiQVBJX1BST0pFQ1QiLCJ1c2VyTG9naW4iLCJtYWluQnV0dG9uIiwiYWNjZXNzX3Rva2VuIiwib25NZXNzYWdlIiwiYWRkTGlzdGVuZXIiLCJtZXNzYWdlIiwic2VuZGVyIiwic2VuZFJlc3BvbnNlIiwiYXBpIiwidXJsIiwiYm9keSIsIm1ldGhvZCIsImhlYWRlcnMiLCJvdmVyd3JpdGVVcmwiLCJwYXJhbXMiLCJiYXNlVXJsIiwiQVBJX1VSTCIsInJlcU9iaiIsIkpTT04iLCJzdHJpbmdpZnkiLCJyZXNwb25zZSIsImZldGNoIiwic3RhdHVzIiwidG9UZXh0IiwidGV4dCIsImpzb24iLCJlcnJvciIsImRhdGEiLCJoZWFkZXIiLCJ0aGVuIiwicmVzIiwidGFicyIsImdldEFsbEluV2luZG93IiwibWFwIiwidGFiIiwic2VuZE1lc3NhZ2UiLCJpZCIsImlzTG9naW4iLCJvbkluc3RhbGxlZCIsImRldGFpbHMiLCJxdWVyeSIsImN1cnJlbnRXaW5kb3ciLCJjb250ZW50anNGaWxlIiwiZ2V0TWFuaWZlc3QiLCJjb250ZW50X3NjcmlwdHMiLCJqcyIsImluZGV4IiwibGVuZ3RoIiwiZXhlY3V0ZVNjcmlwdCIsImZpbGUiLCJyZXN1bHQiLCJvblVwZGF0ZWQiLCJ0YWJJZCIsImNoYW5nZUluZm8iLCJjb25zb2xlIiwibG9nIiwiaW5jbHVkZXMiLCJzdG9wVHJ5VG9HZXREZXNpZ24iLCJzdG9wTG9va0ZvckRlc2lnblRpbWVvdXQiLCJ0YWJJZE9mRGVzaWduIiwiY2xlYXJUaW1lb3V0Iiwic2V0VGltZW91dCIsImNoZWNrVXBkYXRlZFRhYnMiLCJwdXNoIiwiYWNjZXNzVG9rZW4iLCJmaWxlSWQiLCJlIiwicHJldmlldyIsImdldEZpZ21hRGVzaWduIiwidG8iLCJQcm9taXNlIiwicmVzb2x2ZWQiLCJnZXRGaWdtYURlc2lnbkFQSSIsInByb2plY3RTaG9ydElkIiwicHJvamVjdF9zaG9ydF9pZCIsImhvbWVwYWdlX3NsdWciLCJyZWxlYXNlU2hvcnRJZCIsInNob3J0X2lkIiwiY292ZXJ0V2ViVXJsIiwidGFza0lkIiwiY2FuYXJ5VXJsIiwicmVwbGFjZSIsImxvY2FsaG9zdFVybCIsInByb2RVcmwiLCJzdGFydEZldGNoaW5nRmlnbWFEZXNnaW4iLCJzdG9wTG9va0ZvckxvZ2luUG9sbGluZyIsInN0b3BQb2xsaW5nIiwiY2hlY2tUYWJzQXJlVXBkYXRlT3JSZW1vdmVkIiwib3B0aW9ucyIsInBsYXRmb3JtIiwidHlwZSIsImNsZWFySW50ZXJ2YWwiLCJ0aGlzIiwiaW50ZXJ2YWxJbnN0YW5jZSIsImdldEJyb3dzZXJMb2dpblVybCIsImRvbnRBZGRTb3VyY2UiLCJicm93c2VyVXJsIiwiZ2V0RmlnbWFBY2Nlc3NUb2tlbiIsImdldEFjY2Vzc1Rva2VuIiwicGFpcmluZ1Rva2VuIiwiYXV0aE9wdGlvbnMiLCJBdXRob3JpemF0aW9uIiwiY3VycmVudFVzZXIiLCJ1c2VyIiwiYXNzaWduIiwiZXJyb3JPYmoiLCJFcnJvciIsImRlc2NyaXB0aW9uIiwic3RhdHVzQ29kZSIsInN0YXR1c19jb2RlIiwiZ2VuZXJhdGVQYWlyaW5nVG9rZW4iLCJ0b2tlbiIsImV4ZWMiLCJyZXNvbHZlIiwicmVqZWN0IiwicmVzcCIsImNoZWNrUG9sbGluZ1VybCIsInBvbGxpbmdVcmwiLCJzZXRJbnRlcnZhbCIsImNoZWNrSWZUYWJVcGRhdGVkMSIsImZpbmQiLCJmaW5kVGFiIiwib25SZW1vdmVkIiwic2VuZEZpcnN0SW5zdGFsbEV2ZW50Iiwic2VuZFRyYWNrRXZlbnQiLCJldmVudE5hbWUiLCJ1c2VySWQiLCJ1c2VyRW1haWwiLCJhcmdzIiwiZXZlbnRDYXRlZ29yeSIsImV2ZW50QWN0aW9uIiwidWlkIiwiVVVJRCIsImVuY29kZWRTdHJpbmciLCJwcm9wIiwiZW5jb2RlVVJJIiwicGFyYW1ldGl6ZSIsImh0dHAiLCJYTUxIdHRwUmVxdWVzdCIsIm9wZW4iLCJzZXRSZXF1ZXN0SGVhZGVyIiwic2VuZCIsIm9yaWdpbiIsImFsaWFzIiwiZGlzdGluY3RfaWQiLCJwYXJhbWV0ZXJpemUiLCJoIiwidiIsIm9ucmVhZHlzdGF0ZWNoYW5nZSIsInJlYWR5U3RhdGUiLCJzdGF0dXNUZXh0Iiwib25lcnJvciIsInNlbmRSZXF1ZXN0IiwicmVhc29uIiwib2JqIl0sIm1hcHBpbmdzIjoiYUFDRSxJQUFJQSxFQUFtQixHQUd2QixTQUFTQyxFQUFvQkMsR0FHNUIsR0FBR0YsRUFBaUJFLEdBQ25C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VUQsRUFBTyxJQUFNb0IsRUFBSXBCLEtBR2hELE9BQU9EIiwiZmlsZSI6ImJhY2tncm91bmQuYnVuZGxlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZ2V0dGVyIH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuIFx0XHR9XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBjcmVhdGUgYSBmYWtlIG5hbWVzcGFjZSBvYmplY3RcbiBcdC8vIG1vZGUgJiAxOiB2YWx1ZSBpcyBhIG1vZHVsZSBpZCwgcmVxdWlyZSBpdFxuIFx0Ly8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zXG4gXHQvLyBtb2RlICYgNDogcmV0dXJuIHZhbHVlIHdoZW4gYWxyZWFkeSBucyBvYmplY3RcbiBcdC8vIG1vZGUgJiA4fDE6IGJlaGF2ZSBsaWtlIHJlcXVpcmVcbiBcdF9fd2VicGFja19yZXF1aXJlX18udCA9IGZ1bmN0aW9uKHZhbHVlLCBtb2RlKSB7XG4gXHRcdGlmKG1vZGUgJiAxKSB2YWx1ZSA9IF9fd2VicGFja19yZXF1aXJlX18odmFsdWUpO1xuIFx0XHRpZihtb2RlICYgOCkgcmV0dXJuIHZhbHVlO1xuIFx0XHRpZigobW9kZSAmIDQpICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlO1xuIFx0XHR2YXIgbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIobnMpO1xuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkobnMsICdkZWZhdWx0JywgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdmFsdWUgfSk7XG4gXHRcdGlmKG1vZGUgJiAyICYmIHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykgZm9yKHZhciBrZXkgaW4gdmFsdWUpIF9fd2VicGFja19yZXF1aXJlX18uZChucywga2V5LCBmdW5jdGlvbihrZXkpIHsgcmV0dXJuIHZhbHVlW2tleV07IH0uYmluZChudWxsLCBrZXkpKTtcbiBcdFx0cmV0dXJuIG5zO1xuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDM0KTtcbiIsImltcG9ydCBcIi4vYmFja2dyb3VuZENvbmZpZ0ZpbGUuanNcIjtcbmltcG9ydCBcIi4vYmFja2dyb3VuZEdldEZpZ21hUHJldmlld1wiO1xuaW1wb3J0IFwiLi9iYWNrZ3JvdW5kTG9naW4uanNcIjtcbmltcG9ydCBcIi4vYmFja2dyb3VuZFRyYWNraW5nLmpzXCI7XG5cbndpbmRvdy51c2VyTG9naW4gPSBmYWxzZTtcbndpbmRvdy5tYWluQnV0dG9uID0gXCJjb2RlXCI7XG53aW5kb3cuZXh0ZW5zaW9uTmFtZSA9IG51bGw7XG53aW5kb3cudXNlckRhdGE7XG53aW5kb3cuYWNjZXNzX3Rva2VuO1xuXG5jaHJvbWUucnVudGltZS5vbk1lc3NhZ2UuYWRkTGlzdGVuZXIoKG1lc3NhZ2UsIHNlbmRlciwgc2VuZFJlc3BvbnNlKSA9PiB7XG4gIC8qaWYgKG1lc3NhZ2UuYXBpID09PSBcImdldEZlYXR1cmVGbGFnXCIpIHtcbiAgICAgICAgbG9hZEZlYXR1cmVGbGFnKCkudGhlbigoZmVhdHVyZUZsYWdzKT0+e1xuICAgICAgICAgICAgc2VuZFJlc3BvbnNlKGZlYXR1cmVGbGFncylcbiAgICAgICAgfSlcbiAgICB9IFxuICAgIGVsc2UqLyBpZiAoXG4gICAgbWVzc2FnZS5hcGkgPT0gXCJzZW5kQXBpXCJcbiAgKSB7XG4gICAgYXBpKFxuICAgICAgbWVzc2FnZS51cmwsXG4gICAgICBtZXNzYWdlLmRhdGEsXG4gICAgICBtZXNzYWdlLm1ldGhvZCxcbiAgICAgIG1lc3NhZ2UuaGVhZGVyLFxuICAgICAgbWVzc2FnZS5vdmVyd3JpdGVVcmxcbiAgICApLnRoZW4oKHJlcykgPT4ge1xuICAgICAgc2VuZFJlc3BvbnNlKHJlcyk7XG4gICAgfSk7XG4gIH0gZWxzZSBpZiAobWVzc2FnZS5hcGkgPT09IFwibG9nb3V0XCIpIHtcbiAgICBsb2dvdXRJbkFsbFRhYnMoKTtcbiAgfSBlbHNlIGlmIChtZXNzYWdlLmFwaSA9PT0gXCJsb2FkRmVhdHVyZUZsYWdcIikge1xuICAgIHdpbmRvdy5tYWluQnV0dG9uID0gbWVzc2FnZS5tYWluQnV0dG9uO1xuICAgIHdpbmRvdy5leHRlbnNpb25OYW1lID0gbWVzc2FnZS5leHRlbnNpb25OYW1lO1xuICAgIGxvYWRVbmluc3RhbGxQYWdlKCk7XG4gIH0gZWxzZSBpZiAobWVzc2FnZS5hcGkgPT09IFwidXNlckxvZ2luXCIpIHtcbiAgICB3aW5kb3cudXNlckxvZ2luID0gbWVzc2FnZS5pc0xvZ2luO1xuICAgIGxvYWRVbmluc3RhbGxQYWdlKCk7XG4gIH0gZWxzZSBpZiAobWVzc2FnZS5hcGkgPT09IFwidXBkYXRlVXNlckNhY2hlXCIpIHtcbiAgICB3aW5kb3cudXNlckRhdGEgPSBtZXNzYWdlLnVzZXJEYXRhO1xuICAgIHdpbmRvdy5hY2Nlc3NfdG9rZW4gPSBtZXNzYWdlLmFjY2Vzc190b2tlbjtcbiAgICBsb2FkVW5pbnN0YWxsUGFnZSgpO1xuICB9XG4gIHJldHVybiB0cnVlO1xufSk7XG5cbmZ1bmN0aW9uIGxvZ291dEluQWxsVGFicygpIHtcbiAgd2luZG93LnVzZXJEYXRhID0gbnVsbDtcbiAgd2luZG93LmFjY2Vzc190b2tlbiA9IG51bGw7XG5cbiAgLy8gY2hyb21lLnN0b3JhZ2Uuc3luYy5zZXQoeyBhY2Nlc3NfdG9rZW46ICcnIH0sIGZ1bmN0aW9uICh4KSB7fSk7XG4gIC8vIGNocm9tZS5zdG9yYWdlLnN5bmMuc2V0KHsgdXNlckRhdGE6IHt9IH0sIGZ1bmN0aW9uICh4KSB7fSk7XG4gIC8vIGNocm9tZS5zdG9yYWdlLnN5bmMuc2V0KHtjYWNoZVByb2plY3RzOltdfSkvL3NhdmUgdGhhdCB0aGUgcHJvamVjdCBpcyByZWxhdGVkIGZvciB0aGlzIHRlYW0gaWRcblxuICBjaHJvbWUudGFicy5nZXRBbGxJbldpbmRvdygodGFicykgPT4ge1xuICAgIHRhYnMubWFwKCh0YWIpID0+IHtcbiAgICAgIGNocm9tZS50YWJzLnNlbmRNZXNzYWdlKHRhYi5pZCwgeyBtZXNzYWdlOiBcImxvZ291dFwiIH0sIG51bGwsICgpID0+IHt9KTtcbiAgICB9KTtcbiAgfSk7XG59XG5hc3luYyBmdW5jdGlvbiBhcGkoXG4gIHVybCxcbiAgYm9keSxcbiAgbWV0aG9kID0gXCJHRVRcIixcbiAgaGVhZGVycyxcbiAgb3ZlcndyaXRlVXJsID0gZmFsc2UsXG4gIHBhcmFtc1xuKSB7XG4gIGxldCBiYXNlVXJsID1cbiAgICBib2R5ICYmIGJvZHkuYmFzZVVybCA9PT0gXCJwcm9qZWN0c1wiID8gd2luZG93LkFQSV9QUk9KRUNUIDogd2luZG93LkFQSV9VUkw7XG5cbiAgaWYgKGhlYWRlcnMgJiYgaGVhZGVycy5iYXNlVXJsID09PSBcImxvY2FsaG9zdFwiKSB7XG4gICAgYmFzZVVybCA9IFwiaHR0cDovL2xvY2FsaG9zdDo1MDA3XCI7XG4gIH1cbiAgY29uc3QgQVBJX1VSTCA9IG92ZXJ3cml0ZVVybCA/IHVybCA6IGAke2Jhc2VVcmx9JHt1cmx9YDtcblxuICBpZiAoYm9keSAmJiBib2R5LmJhc2VVcmwpIHtcbiAgICBkZWxldGUgYm9keS5iYXNlVXJsO1xuICB9XG5cbiAgY29uc3QgcmVxT2JqID0ge1xuICAgIG1ldGhvZCxcbiAgICBoZWFkZXJzLFxuICAgIGJvZHk6IGJvZHkgPyBKU09OLnN0cmluZ2lmeShib2R5KSA6IG51bGwsXG4gIH07XG5cbiAgbGV0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goQVBJX1VSTCwgcmVxT2JqKTtcblxuICBpZiAocmVzcG9uc2Uuc3RhdHVzID09IDIwMCkge1xuICAgIGlmIChoZWFkZXJzICYmIGhlYWRlcnMudG9UZXh0KSB7XG4gICAgICBsZXQgdGV4dCA9IGF3YWl0IHJlc3BvbnNlLnRleHQoKTtcbiAgICAgIHJldHVybiB0ZXh0O1xuICAgIH0gZWxzZSB7XG4gICAgICBsZXQganNvbiA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgIHJldHVybiBqc29uO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBsZXQganNvbiA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICByZXR1cm4geyBlcnJvcjoganNvbiB9O1xuICB9XG59XG4vLyBhc3luYyBmdW5jdGlvbiBsb2FkRmVhdHVyZUZsYWcoKXtcbi8vICAgICBsZXQgdGV4dCA9ICcnXG4vLyAgICAgdHJ5e1xuLy8gICAgICAgICBsZXQgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCgnaHR0cHM6Ly9kb2NzLmdvb2dsZS5jb20vc3ByZWFkc2hlZXRzL2QvMS1xcjFRMWJPUHJPODNvMEdEWlcwM3FOZ05kVERoV25ZMEtGSVFlMVRldjgvZXhwb3J0P2Zvcm1hdD1jc3YmaWQ9MS1xcjFRMWJPUHJPODNvMEdEWlcwM3FOZ05kVERoV25ZMEtGSVFlMVRldjgmZ2lkPTEwNzIyNTI2OTMnKVxuLy8gICAgICAgICB0ZXh0ID0gYXdhaXQgcmVzcG9uc2UudGV4dCgpO1xuLy8gICAgIH1cbi8vICAgICBjYXRjaChlKXtcbi8vICAgICAgICAgY29uc29sZS5lcnJvcihlKVxuLy8gICAgIH1cblxuLy8gICAgIHJldHVybiB0ZXh0XG4vLyB9XG4vLyBsb2FkRmVhdHVyZUZsYWcoKVxuXG5jaHJvbWUucnVudGltZS5vbkluc3RhbGxlZC5hZGRMaXN0ZW5lcihpbnN0YWxsU2NyaXB0KTtcblxuZnVuY3Rpb24gaW5zdGFsbFNjcmlwdChkZXRhaWxzKSB7XG4gIGNvbnN0IHBhcmFtcyA9IHtcbiAgICBjdXJyZW50V2luZG93OiB0cnVlLFxuICB9O1xuXG4gIGNocm9tZS50YWJzLnF1ZXJ5KHBhcmFtcywgZnVuY3Rpb24gZ290VGFicyh0YWJzKSB7XG4gICAgY29uc3QgY29udGVudGpzRmlsZSA9IGNocm9tZS5ydW50aW1lLmdldE1hbmlmZXN0KCkuY29udGVudF9zY3JpcHRzWzBdLmpzWzBdO1xuICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCB0YWJzLmxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgY2hyb21lLnRhYnMuZXhlY3V0ZVNjcmlwdChcbiAgICAgICAgdGFic1tpbmRleF0uaWQsXG4gICAgICAgIHtcbiAgICAgICAgICBmaWxlOiBjb250ZW50anNGaWxlLFxuICAgICAgICB9LFxuICAgICAgICAocmVzdWx0KSA9PiB7fVxuICAgICAgKTtcbiAgICB9XG4gIH0pO1xufVxuXG4vLyBmdW5jdGlvbiBnZXRVc2VySWQoKSB7XG4vLyAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZWQpID0+IHtcbi8vICAgICB3aW5kb3cuY2hyb21lLnN0b3JhZ2Uuc3luYy5nZXQoXCJ1c2VyRGF0YVwiLCAoZGF0YSkgPT4ge1xuLy8gICAgICAgcmVzb2x2ZWQoZGF0YSlcbi8vICAgICB9KTtcbi8vICAgfSk7XG4vLyB9XG5cbmZ1bmN0aW9uIGdldEV4dERhdGEoKSB7XG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZWQpID0+IHtcbiAgICBjaHJvbWUubWFuYWdlbWVudC5nZXRTZWxmKChkYXRhKSA9PiB7XG4gICAgICByZXNvbHZlZChkYXRhKTtcbiAgICB9KTtcbiAgfSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGxvYWRVbmluc3RhbGxQYWdlKGVtYWlsKSB7XG4gIGlmICh3aW5kb3cuZXh0ZW5zaW9uTmFtZSAhPT0gXCJhbmltYVwiKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgaWYgKHdpbmRvdy51c2VyRGF0YSkge1xuICAgIGNvbnN0IGVtYWlsID1cbiAgICAgIHdpbmRvdy51c2VyRGF0YSAmJiB3aW5kb3cudXNlckRhdGEuZW1haWwgPyB3aW5kb3cudXNlckRhdGEuZW1haWwgOiBcIlwiO1xuXG4gICAgaWYgKGVtYWlsKSB7XG4gICAgICBjaHJvbWUucnVudGltZS5zZXRVbmluc3RhbGxVUkwoXG4gICAgICAgIGAke3dpbmRvdy5BUElfUFJPSkVDVH0vY2hyb21lLWV4dGVuc2lvbi11bmluc3RhbGw/ZW1haWw9JHtlbWFpbH1gXG4gICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICBjaHJvbWUucnVudGltZS5zZXRVbmluc3RhbGxVUkwoXG4gICAgICAgIGAke3dpbmRvdy5BUElfUFJPSkVDVH0vY2hyb21lLWV4dGVuc2lvbi11bmluc3RhbGxgXG4gICAgICApO1xuICAgIH1cbiAgfVxufVxuLy8gY2hyb21lLnRhYnMub25VcGRhdGVkLmFkZExpc3RlbmVyKCh0YWJJZCxjaGFuZ2VJbmZvLHRhYikgPT4gey8vY2hlY2sgaWYgdGhlIHRhYiB1cGRhdGVkXG4vLyAgIGlmKHRhYi51cmwuaW5jbHVkZXMoJ2ZpZ21hLmNvbScpICYmIGNoYW5nZUluZm8uc3RhdHVzID09PSAnbG9hZGluZycgJiYgYWxsQnVuZGxlRmlsZSl7XG4vLyBjaHJvbWUudGFicy5leGVjdXRlU2NyaXB0KHRhYklkLHtcbi8vICAgICBjb2RlOiBhbGxCdW5kbGVGaWxlXG4vLyB9LChhLGIpPT57XG4vLyAgIGNvbnNvbGUubG9nKGEpXG4vLyAgIGNvbnNvbGUubG9nKGIpXG4vLyB9KVxuXG4vLyByZXR1cm5cbi8vIGNocm9tZS50YWJzLmV4ZWN1dGVTY3JpcHQodGFiSWQse1xuLy8gICBjb2RlOiBhbGxCdW5kbGVGaWxlLFxuLy8gICAvLyBmaWxlOlwiaHR0cDovL2xvY2FsaG9zdDozMDAwL3NoYXJlL2FwcC5idW5kbGUuanNcIixcbi8vICAgYWxsRnJhbWVzOiB0cnVlXG4vLyB9KTtcbi8vIGV4ZWN1dGluZy50aGVuKG9uRXhlY3V0ZWQsIG9uRXJyb3IpO1xuLy8gICB9XG4vLyB9KTtcblxubGV0IGxvYWRGcm9tQmFja2dyb3VuZFBhZ2UgPSB0cnVlO1xuXG5pZiAobG9hZEZyb21CYWNrZ3JvdW5kUGFnZSkge1xuICBjaHJvbWUudGFicy5vblVwZGF0ZWQuYWRkTGlzdGVuZXIoKHRhYklkLCBjaGFuZ2VJbmZvLCB0YWIpID0+IHtcbiAgICBjb25zb2xlLmxvZyhcImNoYW5nZUluZm8uc3RhdHVzXCIsIGNoYW5nZUluZm8uc3RhdHVzKTtcbiAgICBpZiAoY2hhbmdlSW5mby5zdGF0dXMgPT09IFwiY29tcGxldGVcIiAmJiB0YWIudXJsLmluY2x1ZGVzKFwiZmlnbWEuY29tXCIpKSB7XG4gICAgICBjaHJvbWUudGFicy5leGVjdXRlU2NyaXB0KHRhYklkLCB7IGZpbGU6IFwiYXBwLmJ1bmRsZS5qc1wiIH0sICgpID0+IHt9KTtcbiAgICB9XG4gIH0pO1xufVxuLy8gZ2V0SnNGaWxlKClcbi8vIGxldCBhbGxCdW5kbGVGaWxlXG4vLyBhc3luYyBmdW5jdGlvbiBnZXRKc0ZpbGUoKXtcbi8vICAgbGV0IGRhdGEgPSBhd2FpdCBmZXRjaCgnaHR0cDovL2xvY2FsaG9zdDozMDAwL3NoYXJlL2FwcC5idW5kbGUuanMnLCB7XG4vLyAgICAgbWV0aG9kOiAnR0VUJyxcbi8vICAgfSk7XG5cbi8vICAgZGF0YSA9IGF3YWl0IGRhdGEudGV4dCgpXG4vLyAgIGFsbEJ1bmRsZUZpbGUgPSBkYXRhXG4vLyB9XG4iLCIvLyB3aW5kb3cuQVBJX1VSTCA9ICdodHRwczovL2NhbmFyeS1hcGkuYW5pbWFhcHAuY29tJ1xuLy8gd2luZG93LkFQSV9QUk9KRUNUID0gJ2h0dHBzOi8vY2FuYXJ5LXByb2plY3RzLmFuaW1hYXBwLmNvbSdcbi8vIHdpbmRvdy5BUElfUFJPSkVDVCA9ICdodHRwOi8vbG9jYWxob3N0OjUwMDInXG53aW5kb3cuQVBJX1VSTCA9ICdodHRwczovL2FwaS5hbmltYWFwcC5jb20nXG53aW5kb3cuQVBJX1BST0pFQ1QgPSAnaHR0cHM6Ly9wcm9qZWN0cy5hbmltYWFwcC5jb20nIiwidmFyIHN0b3BUcnlUb0dldERlc2lnbiA9IGZhbHNlXG5sZXQgc3RvcExvb2tGb3JEZXNpZ25UaW1lb3V0XG5sZXQgdGFiSWRPZkRlc2lnbiA9IG51bGxcblxuY2hyb21lLnJ1bnRpbWUub25NZXNzYWdlLmFkZExpc3RlbmVyKChtZXNzYWdlLCBzZW5kZXIsIHNlbmRSZXNwb25zZSkgPT4ge1xuICAgIGlmIChtZXNzYWdlLmFwaSA9PT0gXCJnZXRGaWdtYURlc2lnbkZyb21BbmltYVwiKSB7XG4gICAgICAgIHRhYklkT2ZEZXNpZ24gPSBzZW5kZXIudGFiLmlkXG4gICAgICAgIHN0b3BUcnlUb0dldERlc2lnbiA9IGZhbHNlXG4gICAgICAgIFxuICAgICAgICBjbGVhclRpbWVvdXQoc3RvcExvb2tGb3JEZXNpZ25UaW1lb3V0KVxuICAgICAgICBzdG9wTG9va0ZvckRlc2lnblRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpPT57Ly9hZnRlciAzIG1pbnV0ZXMgc3RvcCB0cnlpbmcgdG8gZ2V0IHRoZSBkZXNpZ25cbiAgICAgICAgICAgIHN0b3BUcnlUb0dldERlc2lnbiA9IHRydWVcbiAgICAgICAgfSwoMzYwICogMTAwMCkpXG4gICAgICAgIFxuICAgICAgICBpZihzZW5kZXIgJiYgc2VuZGVyLnRhYiAmJiBzZW5kZXIudGFiLmlkKXsvL2lmIHRoaXMgdGFiIHdpbGwgY2xvc2Ugb3IgZGVsZXRlIHdlIHdpbGwgc3RvcCB0aGUgcG9sbGluZ1xuICAgICAgICAgICAgY2hlY2tVcGRhdGVkVGFicy5wdXNoKHNlbmRlci50YWIuaWQpLy93ZSB3aWxsIGNoZWNrIGlmIG9uZSBvZiB0aGUgdGFicyBpbiB0aGlzIGxpc3QgaGFzIGNsb3NlZCBvciB1cGRhdGVkXG4gICAgICAgIH1cbiAgICAgICAgbGV0IGRhdGEgPSBtZXNzYWdlLmRhdGFcbiAgICAgICAgbGV0IGFjY2Vzc1Rva2VuID0gbWVzc2FnZS5hY2Nlc3NUb2tlblxuXG4gICAgICAgIGxldCBmaWxlSWQgPSBkYXRhLmZpbGVJZFxuICAgICAgICBzdGFydEZldGNoaW5nRmlnbWFEZXNnaW4oZGF0YSwgYWNjZXNzVG9rZW4pLnRoZW4odXJsPT57XG4gICAgICAgICAgICBjbGVhclRpbWVvdXQoc3RvcExvb2tGb3JEZXNpZ25UaW1lb3V0KVxuICAgICAgICAgICAgaWYodXJsKXtcbiAgICAgICAgICAgICAgICAvLyBpZighdXJsLmVycm9yKXtcbiAgICAgICAgICAgICAgICAvLyAgICAgc2F2ZVVybEluQ2FjaGUodXJsLGZpbGVJZClcbiAgICAgICAgICAgICAgICAvLyB9XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKT0+e1xuICAgICAgICAgICAgICAgICAgICBzZW5kUmVzcG9uc2UodXJsKVxuICAgICAgICAgICAgICAgIH0sMjAwMClcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICB9IFxuICAgIFxuICAgIHJldHVybiB0cnVlXG59KTtcblxuLy8gZnVuY3Rpb24gc2F2ZVVybEluQ2FjaGUodXJsLGZpbGVJZCl7Ly9zYXZlIHRoZSBkZXNpZ24gaW4gY2FjaGVcbi8vICAgICBjaHJvbWUuc3RvcmFnZS5zeW5jLmdldCgnZXhwb3J0RmlsZXMnLCAoZGF0YSkgPT4ge1xuLy8gICAgICAgICBsZXQgZmlsZSA9IHtcbi8vICAgICAgICAgICAgICAgICAgICAgZmlsZUlkLFxuLy8gICAgICAgICAgICAgICAgICAgICB1cmwsXG4vLyAgICAgICAgICAgICAgICAgICAgIHRpbWVIb3VyOm5ldyBEYXRlKCkuZ2V0SG91cnMoKSxcbi8vICAgICAgICAgICAgICAgICAgICAgZGF5OiBuZXcgRGF0ZSgpLmdldERhdGUoKVxuLy8gICAgICAgICAgICAgICAgIH1cbiAgICAgICAgXG4vLyAgICAgICAgIGlmKCFkYXRhIHx8ICFkYXRhLmV4cG9ydEZpbGVzKXtcbi8vICAgICAgICAgICAgIGNocm9tZS5zdG9yYWdlLnN5bmMuc2V0KHtleHBvcnRGaWxlczpbZmlsZV19LCBmdW5jdGlvbiAoZGF0YSkge30pO1xuLy8gICAgICAgICB9XG4vLyAgICAgICAgIGVsc2Uge1xuLy8gICAgICAgICAgICAgZGF0YS5leHBvcnRGaWxlcy5wdXNoKGZpbGUpXG4vLyAgICAgICAgICAgICBsZXQgZmluZCA9IGRhdGEuZXhwb3J0RmlsZXMuZmluZChkZXNpZ249PntyZXR1cm4gZGVzaWduLmZpbGVJZD09PWZpbGVJZH0pXG4vLyAgICAgICAgICAgICBpZighZmluZCl7XG4vLyAgICAgICAgICAgICAgICAgY2hyb21lLnN0b3JhZ2Uuc3luYy5zZXQoe2V4cG9ydEZpbGVzOmRhdGEuZXhwb3J0RmlsZXN9LCBmdW5jdGlvbiAoZGF0YSkge30pO1xuLy8gICAgICAgICAgICAgfVxuLy8gICAgICAgICB9XG4vLyAgICAgfSk7XG4vLyB9XG5cbi8vIGZ1bmN0aW9uIGNoZWNrRGVzaWduSW5TdG9yYWdlKGRhdGEpe1xuLy8gICAgIGxldCBmaWxlSWQgPSBkYXRhLmZpbGVJZFxuLy8gICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZWQpPT57XG4vLyAgICAgICAgIGNocm9tZS5zdG9yYWdlLnN5bmMuZ2V0KCdleHBvcnRGaWxlcycsIChkYXRhKSA9PiB7XG4vLyAgICAgICAgICAgICBpZighZGF0YSB8fCAhZGF0YS5leHBvcnRGaWxlcyl7XG4vLyAgICAgICAgICAgICAgICAgcmVzb2x2ZWQoKVxuLy8gICAgICAgICAgICAgICAgIHJldHVyblxuLy8gICAgICAgICAgICAgfVxuLy8gICAgICAgICAgICAgbGV0IGZpbmQgPSBkYXRhLmV4cG9ydEZpbGVzLmZpbmQoZGVzaWduPT57cmV0dXJuIGRlc2lnbi5maWxlSWQgPT09IGZpbGVJZCAmJiBkZXNpZ24udGltZUhvdXIgPT09IG5ldyBEYXRlKCkuZ2V0SG91cnMoKX0pXG4vLyAgICAgICAgICAgICByZXNvbHZlZChmaW5kKVxuLy8gICAgICAgICB9KVxuLy8gICAgIH0pXG4vLyB9XG5hc3luYyBmdW5jdGlvbiBzdGFydEZldGNoaW5nRmlnbWFEZXNnaW4oYm9keSwgYWNjZXNzVG9rZW4pe1xuICAgIC8vIGxldCBkZXNpZ25JblN0b3JhZ2UgPSBhd2FpdCBjaGVja0Rlc2lnbkluU3RvcmFnZShib2R5KVxuICAgIC8vIGlmKGRlc2lnbkluU3RvcmFnZSAmJiBkZXNpZ25JblN0b3JhZ2UudXJsKXtcbiAgICAvLyAgICAgcmV0dXJuIGRlc2lnbkluU3RvcmFnZS51cmxcbiAgICAvLyB9XG5cbiAgICAvLyBjb25zdCBBUElfVVJMID0gYCR7d2luZG93LkFQSV9VUkx9L2ZpZ21hX3Rva2VuL3ByZXZpZXdfbW9kZWwvYXN5bmNgO1xuICAgIC8vIGNvbnN0IEFQSV9VUkwgPSBgaHR0cHM6Ly91cy1jZW50cmFsMS1hbmltYS0yMTU5MTkuY2xvdWRmdW5jdGlvbnMubmV0L3Byb2Nlc3NGaWdtYS9nZW5lcmF0ZS9hc3luY2A7XG4gICAgY29uc3QgQVBJX1VSTCA9IGBodHRwczovL2ZpZ21hLXNlcnZpY2UuYW5pbWFhcHAuY29tL2dlbmVyYXRlL2FzeW5jYDtcbiAgICBcbiAgICBhY2Nlc3NUb2tlbiA9IGBKV1QgJHthY2Nlc3NUb2tlbn1gXG4gICAgY29uc3QgcmVxT2JqID0ge1xuICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgICAgICdBdXRob3JpemF0aW9uJzogYWNjZXNzVG9rZW5cbiAgICAgICAgfSxcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoYm9keSksXG4gICAgfTtcblxuICAgIGxldCByZXNwb25zZVxuICAgIHRyeXtcbiAgICAgICAgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChBUElfVVJMLCByZXFPYmopO1xuICAgIH1cbiAgICBjYXRjaChlKXtcbiAgICAgICAgY29uc29sZS5lcnJvcihlKVxuICAgICAgICAvLyBpZihlLm1lc3NhZ2UgPT09ICdGYWlsZWQgdG8gZmV0Y2gnKXtcbiAgICAgICAgLy8gICAgIHJldHVybiB7ZXJyb3I6J0ludmFsaWQgdG9rZW4nfVxuICAgICAgICAvLyB9XG4gICAgfVxuXG4gICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PSAyMDAgfHwgcmVzcG9uc2Uuc3RhdHVzID09IDIwMSkge1xuICAgICAgICBzdG9wVHJ5VG9HZXREZXNpZ24gPSBmYWxzZVxuICAgICAgICBcbiAgICAgICAgbGV0IGpzb24gPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG5cbiAgICAgICAgbGV0IHByZXZpZXcgXG4gICAgICAgIHRyeXtcbiAgICAgICAgICAgIHByZXZpZXcgPSBhd2FpdCBnZXRGaWdtYURlc2lnbih7dGFza0lkOmpzb24udGFza0lkLGFjY2Vzc1Rva2VufSlcbiAgICAgICAgfVxuICAgICAgICBjYXRjaChlKXtcbiAgICAgICAgICAgIHJldHVybiB7ZXJyb3I6J0Vycm9yOiBjb252ZXJ0IEZpZ21hIGZpbGUgdG8gZGVzaWduIGZhaWxlZCd9XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGlmKHByZXZpZXcuZXJyb3Ipe1xuICAgICAgICAgICAgcmV0dXJuIHByZXZpZXdcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBjYW5hcnlVcmwgPSBwcmV2aWV3LnJlcGxhY2UoJ3Byb2plY3RzLicsJ2NhbmFyeS1wcm9qZWN0cy4nKS5yZXBsYWNlKCdwcm90b3R5cGUnLCdvbW5pdmlldycpXG4gICAgICAgIGxldCBsb2NhbGhvc3RVcmwgPSBwcmV2aWV3LnJlcGxhY2UoJ3Byb2plY3RzLmFuaW1hYXBwLmNvbScsJ2xvY2FsaG9zdDo1MDAyJykucmVwbGFjZSgncHJvdG90eXBlJywnb21uaXZpZXcnKS5yZXBsYWNlKCdodHRwcycsJ2h0dHAnKVxuICAgICAgICBsZXQgcHJvZFVybCA9IHByZXZpZXcucmVwbGFjZSgncHJvdG90eXBlJywnb21uaXZpZXcnKVxuICAgICAgICBcbiAgICAgICAgY29uc29sZS5sb2coJ2NhbmFyeVVybCcsY2FuYXJ5VXJsKVxuICAgICAgICBjb25zb2xlLmxvZygnbG9jYWxob3N0VXJsJyxsb2NhbGhvc3RVcmwpXG4gICAgICAgIGNvbnNvbGUubG9nKCdwcm9kVXJsJyxwcm9kVXJsKVxuXG4gICAgICAgIC8vIHJldHVybiBsb2NhbGhvc3RVcmxcbiAgICAgICAgcmV0dXJuIHdpbmRvdy5BUElfUFJPSkVDVC5pbmNsdWRlcygnaHR0cHM6Ly9wcm9qZWN0cy5hbmltYWFwcC5jb20nKSA/IHByb2RVcmwgOiBjYW5hcnlVcmxcblxuICAgICAgICAvLyBsZXQgcHJvamVjdElkID0gcHJldmlldy5zcGxpdCgnL3AvJylbMV0uc3BsaXQoJy8nKVswXVxuICAgICAgICAvLyBsZXQgY29kZURlc2lnblxuICAgICAgICAvLyB0cnl7XG4gICAgICAgIC8vICAgICBjb2RlRGVzaWduID0gYXdhaXQgY29udmVydERlc2lnblRvQ29kZShwcmV2aWV3LCBwcm9qZWN0SWQsIGFjY2Vzc1Rva2VuKVxuICAgICAgICAvLyB9XG4gICAgICAgIC8vIGNhdGNoKGUpe1xuICAgICAgICAvLyAgICAgcmV0dXJuIHtlcnJvcjonU3luYyBkZXNpZ24gdG8gQW5pbWEgZmFpbGVkJ31cbiAgICAgICAgLy8gfVxuICAgICAgICAvLyBpZihjb2RlRGVzaWduLmVycm9yKXtyZXR1cm4gY29kZURlc2lnbn1cblxuICAgICAgICAvLyBjaHJvbWUudGFicy5zZW5kTWVzc2FnZSh0YWJJZCwge3RvOiBcIkFuaW1hU3RvcmVcIixjaGFuZ2VUZXh0OiBcIlN5bmNpbmdcIn0pXG5cbiAgICAgICAgLy8gbGV0IHN5bmNEZXNpZ25SZXMgPSBhd2FpdCBzeW5jRGVzaWduKGNvZGVEZXNpZ24sIHByb2plY3RJZCwgYWNjZXNzVG9rZW4pXG4gICAgICAgIC8vIGlmKHN5bmNEZXNpZ25SZXMuZXJyb3Ipe3JldHVybiBzeW5jRGVzaWduUmVzfVxuXG4gICAgICAgIC8vIGxldCBwYWdlTmFtZSA9IHN5bmNEZXNpZ25SZXMucGFnZV9uYW1lcyA/IHN5bmNEZXNpZ25SZXMucGFnZV9uYW1lc1swXSA6ICcnXG4gICAgICAgIC8vIGxldCB1cmwgPSBgJHt3aW5kb3cuQVBJX1BST0pFQ1R9L3RlYW0vbmV3MS1wN3puZ3ZsL3Byb2plY3QvJHtzeW5jRGVzaWduUmVzLnNob3J0X2lkfS9zY3JlZW4vJHtwYWdlTmFtZX0vb21uaXZpZXdgXG4gICAgICAgIFxuICAgICAgICAvLyBsZXQgdXJsID0gYGh0dHA6Ly9sb2NhbGhvc3Q6NTAwMi90ZWFtL25ldzEtcDd6bmd2bC9wcm9qZWN0LyR7c3luY0Rlc2lnblJlcy5zaG9ydF9pZH0vc2NyZWVuLyR7cGFnZU5hbWV9L29tbml2aWV3YFxuXG4gICAgICAgIHJldHVybiB1cmxcbiAgICB9XG4gICAgZWxzZSBpZihyZXNwb25zZS5zdGF0dXMgPT09IDQwMCl7XG4gICAgICAgIHJlc3BvbnNlID0gYXdhaXQgcmVzcG9uc2UuanNvbigpXG4gICAgICAgIHJldHVybiB7ZXJyb3I6cmVzcG9uc2UubWVzc2FnZX1cbiAgICB9XG4gICAgZWxzZXtcbiAgICAgICAgcmV0dXJuIHtlcnJvcjonRXJyb3I6IGFzeW5jIGRlc2lnbiBmYWlsZWQnfVxuICAgIH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gc3luY0Rlc2lnbihkYXRhLCBwcm9qZWN0SWQsIGFjY2Vzc1Rva2VuKXtcbiAgICBjb25zdCBBUElfVVJMID0gYCR7d2luZG93LkFQSV9VUkx9L3YyL3Byb2plY3RzLyR7cHJvamVjdElkfWA7XG4gICAgXG4gICAgbGV0IGJvZHkgPSB7XCJsaXZlX3Byb2plY3RfcmVsZWFzZVwiOntcInR5cGVcIjpcInByb2plY3RfcmVsZWFzZXNcIixcImlkXCI6ZGF0YS5pZH19XG4gICAgY29uc3QgcmVxT2JqID0ge1xuICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgICAgICdBdXRob3JpemF0aW9uJzogYWNjZXNzVG9rZW5cbiAgICAgICAgfSxcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoYm9keSksXG4gICAgfTtcblxuICAgIGxldCByZXNwb25zZSA9IGF3YWl0IGZldGNoKEFQSV9VUkwsIHJlcU9iaik7XG4gICAgdHJ5e1xuICAgICAgICBsZXQganNvbiA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgaWYoanNvbi5pc19zeW5jaW5nICYmICFzdG9wVHJ5VG9HZXREZXNpZ24pe1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlZCk9PntcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpPT57XG4gICAgICAgICAgICAgICAgICAgICAgICBzeW5jRGVzaWduKGRhdGEscHJvamVjdElkLGFjY2Vzc1Rva2VuKS50aGVuKGRhdGE9PntcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmVkKGRhdGEpXG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgfSwyMDAwKVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmKHN0b3BUcnlUb0dldERlc2lnbil7XG4gICAgICAgICAgICByZXR1cm4ge2Vycm9yOlwiQ2FuJ3QgZXhwb3J0IHRoZSBkZXNpZ24gdG8gQW5pbWFcIn1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBqc29uXG4gICAgfVxuICAgIGNhdGNoKGUpe1xuICAgICAgICByZXR1cm4ge2Vycm9yOlwiQ2FuJ3QgZXhwb3J0IHRoZSBkZXNpZ24gdG8gQW5pbWFcIn1cbiAgICB9XG59XG5hc3luYyBmdW5jdGlvbiBjb252ZXJ0RGVzaWduVG9Db2RlKHByZXZpZXcsIHByb2plY3RJZCwgYWNjZXNzVG9rZW4pe1xuICAgIGNvbnN0IEFQSV9VUkwgPSBgJHt3aW5kb3cuQVBJX1VSTH0vdjIvcHJvamVjdHMvJHtwcm9qZWN0SWR9L3Byb2plY3RfcmVsZWFzZXNgO1xuICAgIFxuICAgIGxldCBzaG9ydElkID0gcHJldmlldy5zcGxpdCgnL3AvJylbMV0uc3BsaXQoJy8nKVsxXVxuICAgIGxldCBib2R5ID0ge1wicmVsZWFzZVwiOntcInR5cGVcIjpcInJlbGVhc2VzXCIsXCJzaG9ydF9pZFwiOnNob3J0SWR9fVxuICAgIGNvbnN0IHJlcU9iaiA9IHtcbiAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAgICAgICAnQXV0aG9yaXphdGlvbic6IGFjY2Vzc1Rva2VuXG4gICAgICAgIH0sXG4gICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KGJvZHkpLFxuICAgIH07XG4gICAgXG4gICAgbGV0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goQVBJX1VSTCwgcmVxT2JqKTtcbiAgICBsZXQganNvbiA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICBcbiAgICByZXR1cm4ganNvblxufVxuXG5mdW5jdGlvbiBjb3ZlcnRXZWJVcmwodXJsKXtcbiAgICBsZXQgcHJvamVjdFNob3J0SWQgPSB1cmwucHJvamVjdF9zaG9ydF9pZFxuICAgIGxldCBob21lcGFnZV9zbHVnID0gdXJsLmhvbWVwYWdlX3NsdWdcbiAgICBsZXQgcmVsZWFzZVNob3J0SWQgPSB1cmwuc2hvcnRfaWRcblxuICAgIC8vIHJldHVybiBgaHR0cDovL2xvY2FsaG9zdDo1MDAyL3AvJHtwcm9qZWN0U2hvcnRJZH0vJHtyZWxlYXNlU2hvcnRJZH0vJHtob21lcGFnZV9zbHVnfS9zeW5jd2Vic2l0ZT9leHRlbnNpb25OYW1lPSR7d2luZG93LmV4dGVuc2lvbk5hbWV9YFxuICAgIHJldHVybiBgaHR0cDovL3Byb2plY3RzLmFuaW1hYXBwLmNvbS9wLyR7cHJvamVjdFNob3J0SWR9LyR7cmVsZWFzZVNob3J0SWR9LyR7aG9tZXBhZ2Vfc2x1Z30vc3luY3dlYnNpdGU/ZXh0ZW5zaW9uTmFtZT0ke3dpbmRvdy5leHRlbnNpb25OYW1lfWBcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0RmlnbWFEZXNpZ24oYm9keSl7XG4gICAgbGV0IHJlc3BvbnNlID0gYXdhaXQgZ2V0RmlnbWFEZXNpZ25BUEkoYm9keSlcblxuICAgIGlmKHJlc3BvbnNlLmVycm9yKXtcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlXG4gICAgfVxuICAgIGVsc2UgaWYocmVzcG9uc2Uuc3RhdHVzID09PSA0MDApe1xuICAgICAgICByZXNwb25zZSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKVxuICAgICAgICByZXR1cm4gcmVzcG9uc2VcbiAgICB9XG4gICAgZWxzZSBpZihyZXNwb25zZS5zdGF0dXMgPT09IDIwNCAmJiAhc3RvcFRyeVRvR2V0RGVzaWduKSB7XG4gICAgICAgIHJldHVybiBhd2FpdCBnZXRGaWdtYURlc2lnbihib2R5KVxuICAgIH1cbiAgICBlbHNlIGlmKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICAgIGxldCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgICAgICBcbiAgICAgICAgcmV0dXJuIGNvdmVydFdlYlVybChkYXRhKVxuICAgIH1cbiAgICBlbHNlIGlmKHN0b3BUcnlUb0dldERlc2lnbil7XG4gICAgICAgIHJldHVybiB7ZXJyb3I6J0Vycm9yOiBjb252ZXJ0IEZpZ21hIGZpbGUgdG8gZGVzaWduIGZhaWxlZCd9XG4gICAgfVxufVxuYXN5bmMgZnVuY3Rpb24gZ2V0RmlnbWFEZXNpZ25BUEkoYm9keSxhY2Nlc3NUb2tlbil7XG4gICAgLy8gY29uc3QgQVBJX1VSTCA9IGAke3dpbmRvdy5BUElfVVJMfS9maWdtYV90b2tlbi90YXNrL2NhbGxiYWNrYDtcbiAgICAvLyBjb25zdCBBUElfVVJMID0gYGh0dHBzOi8vdXMtY2VudHJhbDEtYW5pbWEtMjE1OTE5LmNsb3VkZnVuY3Rpb25zLm5ldC9wcm9jZXNzRmlnbWEvdGFzay9jYWxsYmFja2A7XG4gICAgLy8gY29uc3QgQVBJX1VSTCA9IGBodHRwczovL2FwaS5hbmltYWFwcC5jb20vZmlnbWFfdG9rZW4vdGFzay9jYWxsYmFja2A7XG4gICAgY29uc3QgQVBJX1VSTCA9IGBodHRwczovL2ZpZ21hLXNlcnZpY2UuYW5pbWFhcHAuY29tL3Rhc2svY2FsbGJhY2tgO1xuXG4gICAgY29uc3QgcmVxT2JqID0ge1xuICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgICAgICdBdXRob3JpemF0aW9uJzogYm9keS5hY2Nlc3NUb2tlblxuICAgICAgICB9LFxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShib2R5KSxcbiAgICB9O1xuXG5cbiAgICBsZXQgcmVzcG9uc2VcbiAgICB0cnl7XG4gICAgICAgIHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goQVBJX1VSTCwgcmVxT2JqKTtcbiAgICB9XG4gICAgY2F0Y2goZSl7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZSlcbiAgICAgICAgLy8gaWYoZS5tZXNzYWdlID09PSAnRmFpbGVkIHRvIGZldGNoJyl7XG4gICAgICAgIC8vICAgICByZXR1cm4ge2Vycm9yOidJbnZhbGlkIHRva2VuJ31cbiAgICAgICAgLy8gfVxuICAgIH1cbiAgICBcbiAgICBpZihyZXNwb25zZS5zdGF0dXMgPT09IDQwMCl7XG4gICAgICAgIHJldHVybiByZXNwb25zZVxuICAgIH1cbiAgICBlbHNlIGlmKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKXtcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlXG4gICAgfVxuICAgIGVsc2UgaWYocmVzcG9uc2Uuc3RhdHVzID09PSAyMDQpey8vaWYgdGhlIGZpbGUgaXMgc3RpbGwgcHJvY2Vzc2luZyB3YWl0IGZvciAxIHNlY29uZHNcbiAgICAgICAgY2hyb21lLnRhYnMuZ2V0QWxsSW5XaW5kb3coKHRhYnMpPT57XG4gICAgICAgICAgICB0YWJzLm1hcCh0YWI9PntcbiAgICAgICAgICAgICAgY2hyb21lLnRhYnMuc2VuZE1lc3NhZ2UodGFiLmlkLCB7dG86J0FuaW1hU3RvcmUnLG1lc3NhZ2U6J2FkZC1wZXJjZW50YWdlJ30sIG51bGwsICgpPT57fSlcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pXG5cbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlZCk9PntcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCk9PntcbiAgICAgICAgICAgICAgICByZXNvbHZlZChyZXNwb25zZSlcbiAgICAgICAgICAgIH0sMjAwMClcbiAgICAgICAgfSlcbiAgICB9XG59XG5cbmxldCBjaGVja1VwZGF0ZWRUYWJzID0gW11cbi8vIGNocm9tZS50YWJzLm9uUmVtb3ZlZC5hZGRMaXN0ZW5lcigodGFiSWQpID0+IHsvL2NoZWNrIGlmIHRoZSB0YWIgZGVsZXRlZFxuLy8gICAgIGlmKHRhYklkID09PSB0YWJJZE9mRGVzaWduKXtcbi8vICAgICAgICAgY2hlY2tJZlRhYlVwZGF0ZWQodGFiSWQpXG4vLyAgICAgfVxuLy8gfSk7XG5cbi8vIGNocm9tZS50YWJzLm9uVXBkYXRlZC5hZGRMaXN0ZW5lcigodGFiSWQsY2hhbmdlSW5mbyx0YWIpID0+IHsvL2NoZWNrIGlmIHRoZSB0YWIgdXBkYXRlZFxuLy8gICAgIGNvbnNvbGUubG9nKCdjaGFuZ2VJbmZvLnN0YXR1cycsY2hhbmdlSW5mby5zdGF0dXMpXG4vLyAgICAgaWYodGFiLnVybC5pbmNsdWRlcygnZmlnbWEuY29tJykgJiYgY2hhbmdlSW5mby5zdGF0dXMgPT09ICdsb2FkaW5nJyl7XG4vLyAgICAgICAgIGNocm9tZS50YWJzLmV4ZWN1dGVTY3JpcHQodGFiSWQse1xuLy8gICAgICAgICAgICAgY29kZTogYGFsZXJ0KCdpIGFtIGhlcmUnKTtgXG4vLyAgICAgICAgIH0pXG4vLyAgICAgfVxuLy8gICAgIC8vIGlmKGNoYW5nZUluZm8uc3RhdHVzID09PSAnbG9hZGluZycgJiYgdGFiSWQgPT09IHRhYklkT2ZEZXNpZ24pe1xuLy8gICAgIC8vICAgICBjaGVja0lmVGFiVXBkYXRlZCh0YWJJZClcbi8vICAgICAvLyB9XG4vLyB9KTtcbi8vIGZ1bmN0aW9uIGNoZWNrSWZUYWJVcGRhdGVkKHRhYklkKXsvL2lmIHRoZSB0YWIgZGVsZXRlZCBvciB1cGRhdGVkIHN0b3AgdGhlIHBvbGxpbmdcbi8vICAgICBsZXQgZmluZElmUmVmcmVzaGVkID0gY2hlY2tVcGRhdGVkVGFicy5maW5kKGZpbmRUYWI9PmZpbmRUYWI9PT10YWJJZClcbi8vICAgICBpZihmaW5kSWZSZWZyZXNoZWQpe1xuLy8gICAgICAgICBzdG9wVHJ5VG9HZXREZXNpZ24gPSB0cnVlXG4vLyAgICAgfVxuLy8gfSAiLCJsZXQgc3RvcFBvbGxpbmcgPSBmYWxzZVxubGV0IGNoZWNrVGFic0FyZVVwZGF0ZU9yUmVtb3ZlZCA9IFtdXG5sZXQgc3RvcExvb2tGb3JMb2dpblBvbGxpbmdcblxuY2hyb21lLnJ1bnRpbWUub25NZXNzYWdlLmFkZExpc3RlbmVyKChtZXNzYWdlLCBzZW5kZXIsIHNlbmRSZXNwb25zZSkgPT4ge1xuICAgIGxldCBvcHRpb25zID0geyBwbGF0Zm9ybTogJ2ZpZ21hJywgdG86IG1lc3NhZ2UudHlwZSA/IG1lc3NhZ2UudHlwZSA6ICdsb2dpbid9O1xuICAgIGlmIChtZXNzYWdlLmFwaSA9PT0gXCJnZXRMb2dpblVybFwiKSB7XG4gICAgICBpZihzZW5kZXIgJiYgc2VuZGVyLnRhYiAmJiBzZW5kZXIudGFiLmlkKXsvL2lmIHRoaXMgdGFiIHdpbGwgY2xvc2Ugb3IgZGVsZXRlIHdlIHdpbGwgc3RvcCB0aGUgcG9sbGluZ1xuICAgICAgICBjaGVja1RhYnNBcmVVcGRhdGVPclJlbW92ZWQucHVzaChzZW5kZXIudGFiLmlkKS8vd2Ugd2lsbCBjaGVjayBpZiBvbmUgb2YgdGhlIHRhYnMgaW4gdGhpcyBsaXN0IGhhcyBjbG9zZWQgb3IgdXBkYXRlZFxuICAgICAgfVxuICAgICAgXG4gICAgICBjbGVhclRpbWVvdXQoc3RvcExvb2tGb3JMb2dpblBvbGxpbmcpXG4gICAgICBzdG9wTG9va0ZvckxvZ2luUG9sbGluZyA9IHNldFRpbWVvdXQoKCk9PnsvL3N0b3AgdGhlIHBvbGxpbmcgYWZ0ZXIgMyBtaW51dGVzXG4gICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5pbnRlcnZhbEluc3RhbmNlKVxuICAgICAgfSwxODAgKiAxMDAwKVxuICAgICAgXG4gICAgICBnZXRCcm93c2VyTG9naW5VcmwobnVsbCwgb3B0aW9ucyAsbWVzc2FnZS5kb250QWRkU291cmNlKS50aGVuKChicm93c2VyVXJsKT0+e1xuICAgICAgICAgIHNlbmRSZXNwb25zZShicm93c2VyVXJsKVxuICAgICAgfSlcbiAgICB9IFxuICAgIGVsc2UgaWYobWVzc2FnZS5hcGkgPT09IFwiZ2V0RmlnbWFBY2Nlc3NUb2tlblwiKXtcbiAgICAgIGdldEZpZ21hQWNjZXNzVG9rZW4obWVzc2FnZS5ib2R5LCBtZXNzYWdlLmFjY2Vzc190b2tlbilcbiAgICB9XG4gICAgZWxzZSBpZihtZXNzYWdlLmFwaSA9PT0gJ2NoZWNrSWZXZUhhdmVTdG9yYWdlVXNlcicpe1xuICAgICAgc2VuZFJlc3BvbnNlKHt1c2VyRGF0YTp3aW5kb3cudXNlckRhdGEsIGFjY2Vzc190b2tlbjp3aW5kb3cuYWNjZXNzX3Rva2VufSlcbiAgICB9XG4gICAgZWxzZSBpZiAobWVzc2FnZS5hcGkgPT09ICdnZXRVc2VyQWZ0ZXJMb2dpbicpe1xuICAgICAgICBnZXRBY2Nlc3NUb2tlbihtZXNzYWdlLmRhdGEucGFpcmluZ1Rva2VuICxvcHRpb25zKS50aGVuKChkYXRhKT0+e1xuICAgICAgICAgIGlmKHNlbmRlciAmJiBzZW5kZXIudGFiICYmIHNlbmRlci50YWIuaWQpe1xuICAgICAgICAgICAgY2hlY2tUYWJzQXJlVXBkYXRlT3JSZW1vdmVkLnB1c2goc2VuZGVyLnRhYi5pZClcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBsZXQgYXV0aE9wdGlvbnMgPSB7XG4gICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICdYLUNsaWVudC1JZCc6ICdjb20uYW5pbWFhcHAuZmlnbWEnLFxuICAgICAgICAgICAgICAnWC1DbGllbnQtVmVyc2lvbic6ICcwLjAuMScsXG4gICAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBKV1QgJHtkYXRhLmFjY2Vzc190b2tlbn1gLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9O1xuXG4gICAgICAgICAgY3VycmVudFVzZXIoYXV0aE9wdGlvbnMpLnRoZW4odXNlcj0+e1xuICAgICAgICAgICAgd2luZG93LnVzZXJEYXRhID0gdXNlclxuICAgICAgICAgICAgd2luZG93LmFjY2Vzc190b2tlbiA9IGRhdGEuYWNjZXNzX3Rva2VuXG5cbiAgICAgICAgICAgIC8vIGNocm9tZS5zdG9yYWdlLnN5bmMuc2V0KHsgYWNjZXNzX3Rva2VuOiBkYXRhLmFjY2Vzc190b2tlbiB9LCBmdW5jdGlvbiAoeCkge30pO1xuICAgICAgICAgICAgLy8gY2hyb21lLnN0b3JhZ2Uuc3luYy5zZXQoeyB1c2VyRGF0YTogdXNlciB9LCBmdW5jdGlvbiAoeCkge30pO1xuXG4gICAgICAgICAgICBzZW5kUmVzcG9uc2Uoe3VzZXIsIGFjY2Vzc190b2tlbjpkYXRhLmFjY2Vzc190b2tlbn0pXG4gICAgICAgICAgfSlcbiAgICAgICAgfSlcbiAgICB9XG4gICAgcmV0dXJuIHRydWVcbn0pO1xuXG5jb25zdCBnZXRGaWdtYUFjY2Vzc1Rva2VuID0gYXN5bmMgKGJvZHksIGFjY2Vzc190b2tlbikgPT4ge1xuICBjb25zdCBBUElfVVJMID0gYCR7d2luZG93LkFQSV9VUkx9L2ZpZ21hX3Rva2VuL2dlbmVyYXRlYDtcblxuICBjb25zdCByZXFPYmogPSB7XG4gICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgaGVhZGVyczoge1xuICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICdYLUNsaWVudC1JZCc6ICdjb20uYW5pbWFhcHAuZmlnbWEnLFxuICAgICAgJ1gtQ2xpZW50LVZlcnNpb24nOiAnMC4wLjEnLFxuICAgICAgQXV0aG9yaXphdGlvbjogYEpXVCAke2FjY2Vzc190b2tlbn1gXG4gICAgfSxcbiAgICBib2R5XG4gIH07XG4gIGxldCByZXNwb25zZSA9IGF3YWl0IGZldGNoKEFQSV9VUkwsIHJlcU9iaik7XG59XG5cbmNvbnN0IGN1cnJlbnRVc2VyID0gYXN5bmMgKG9wdGlvbnMpID0+IHtcbiAgICBjb25zdCBBUElfVVJMID0gYCR7d2luZG93LkFQSV9VUkx9L3VzZXJzL21lYDtcbiAgXG4gICAgY29uc3QgQVVUSF9IRUFERVJTID0ge1xuICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICB9O1xuICBcbiAgICBjb25zdCByZXFPYmogPSB7XG4gICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgaGVhZGVyczogQVVUSF9IRUFERVJTLFxuICAgIH07XG4gIFxuICAgIGlmIChvcHRpb25zLmhlYWRlcnMpIHtcbiAgICAgIHJlcU9iai5oZWFkZXJzID0gT2JqZWN0LmFzc2lnbihyZXFPYmouaGVhZGVycywgb3B0aW9ucy5oZWFkZXJzKTtcbiAgICB9XG4gIFxuICAgIGxldCByZXNwb25zZSA9IGF3YWl0IGZldGNoKEFQSV9VUkwsIHJlcU9iaik7XG4gIFxuICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT0gMjAwKSB7XG4gICAgICBsZXQganNvbiA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgIHJldHVybiBqc29uO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zb2xlLmxvZygnRVJST1IgR0VUVElORyBDVVJSRU5UIFVTRVIgPiAnLCByZXNwb25zZSk7XG4gICAgICBsZXQganNvbiA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgIGlmIChqc29uLmVycm9yKSB7XG4gICAgICAgIGxldCBlcnJvck9iaiA9IG5ldyBFcnJvcihqc29uLmRlc2NyaXB0aW9uIHx8ICdTb21ldGhpbmcgd2VudCB3cm9uZyEnKTtcbiAgICAgICAgZXJyb3JPYmouc3RhdHVzQ29kZSA9IGpzb24uc3RhdHVzX2NvZGUgfHwgcmVzcG9uc2Uuc3RhdHVzIHx8IDUwMDtcbiAgICAgICAgZXJyb3JPYmouZXJyb3IgPSBqc29uLmVycm9yIHx8ICdFcnJvcic7XG4gICAgICAgIHRocm93IGVycm9yT2JqO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbGV0IGVycm9yT2JqID0gbmV3IEVycm9yKCdTb21ldGhpbmcgd2VudCB3cm9uZyEnKTtcbiAgICAgICAgZXJyb3JPYmouc3RhdHVzQ29kZSA9IHJlc3BvbnNlLnN0YXR1cyB8fCA1MDA7XG4gICAgICAgIGVycm9yT2JqLmVycm9yID0gJ0Vycm9yJztcbiAgICAgICAgdGhyb3cgZXJyb3JPYmo7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG5jb25zdCBnZXRCcm93c2VyTG9naW5VcmwgPSBhc3luYyAocGFpcmluZ1Rva2VuLCBvcHRpb25zID0ge30sIGRvbnRBZGRTb3VyY2UpID0+IHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoIXBhaXJpbmdUb2tlbikge1xuICAgICAgICAgICAgbGV0IHJlc3AgPSBhd2FpdCBnZW5lcmF0ZVBhaXJpbmdUb2tlbihvcHRpb25zKTtcbiAgICAgICAgICAgIHBhaXJpbmdUb2tlbiA9IHJlc3AudG9rZW47XG4gICAgICAgIH1cbiAgICAgICAgLy9idWlsZCB0aGUgdXJsXG4gICAgICAgIGxldCB1cmwgPSBgJHt3aW5kb3cuQVBJX1BST0pFQ1R9LyR7b3B0aW9ucyAmJiBvcHRpb25zLnRvICYmIG9wdGlvbnMudG89PT0nc2lnbnVwJyA/ICdzaWdudXAnIDogJ2xvZ2luJ30/cGFpcmluZz10cnVlJnB0PSR7cGFpcmluZ1Rva2VufSZwbGF0Zm9ybT0ke29wdGlvbnMucGxhdGZvcm19YFxuXG4gICAgICAgIGlmKG9wdGlvbnMgLyomJiBvcHRpb25zLnRvID09PSAnc2lnbnVwJyovKXsvL2lmIGl0J3Mgc2lnbnVwIGZsb3cgYWRkIG1vcmUgcGFyYW1zXG4gICAgICAgICAgICB1cmwgPSB1cmwgKyAoZG9udEFkZFNvdXJjZSA/IGRvbnRBZGRTb3VyY2UgOiBgJnBsYXRmb3JtPSR7b3B0aW9ucy5wbGF0Zm9ybX0mdXRtX21lZGl1bT1wbHVnaW4mdXRtX3NvdXJjZT1maWdtYSZ1dG1fY29udGVudD1zaWdudXAtYnV0dG9uYClcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCByZXNwT2JqID0ge1xuICAgICAgICAgICAgdXJsLFxuICAgICAgICAgICAgcGFpcmluZ1Rva2VuLFxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gcmVzcE9iajtcbiAgICB9IGNhdGNoIChleGVjKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdFUlJPUiA+IEdFVFRJTkcgQlJPV1NFUiBMT0dJTiBVUkwgPiAnLCBleGVjKTtcbiAgICAgICAgdGhyb3cgZXhlYztcbiAgICB9XG59XG5cbmNvbnN0IGdlbmVyYXRlUGFpcmluZ1Rva2VuID0gYXN5bmMgKG9wdGlvbnMgPSB7fSkgPT4ge1xuICAgIHRyeSB7XG4gICAgICBzdG9wUG9sbGluZyA9IGZhbHNlO1xuICAgICAgY29uc3QgQVBJX1VSTCA9IGAke3dpbmRvdy5BUElfVVJMfS9ycGMvZ2VuZXJhdGVfcGFpcmluZ190b2tlbmA7XG5cbiAgICAgIGNvbnN0IHJlcU9iaiA9IHtcbiAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICB9LFxuICAgICAgfTtcblxuICAgICAgaWYgKG9wdGlvbnMuaGVhZGVycykge1xuICAgICAgICByZXFPYmouaGVhZGVycyA9IE9iamVjdC5hc3NpZ24ocmVxT2JqLmhlYWRlcnMsIG9wdGlvbnMuaGVhZGVycyk7XG4gICAgICB9XG5cbiAgICAgIGxldCByZXNwb25zZSA9IGF3YWl0IGZldGNoKEFQSV9VUkwsIHJlcU9iaik7XG4gICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09IDIwMCkge1xuICAgICAgICBsZXQganNvbiA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgcmV0dXJuIGpzb247XG4gICAgICB9XG4gICAgICBsZXQganNvbiA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgIGlmIChqc29uLmVycm9yKSB7XG4gICAgICAgIGxldCBlcnJvck9iaiA9IG5ldyBFcnJvcihqc29uLmRlc2NyaXB0aW9uIHx8ICdTb21ldGhpbmcgd2VudCB3cm9uZyEnKTtcbiAgICAgICAgZXJyb3JPYmouc3RhdHVzQ29kZSA9IGpzb24uc3RhdHVzX2NvZGUgfHwgcmVzcG9uc2Uuc3RhdHVzIHx8IDUwMDtcbiAgICAgICAgZXJyb3JPYmouZXJyb3IgPSBqc29uLmVycm9yIHx8ICdFcnJvcic7XG4gICAgICAgIHRocm93IGVycm9yT2JqO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbGV0IGVycm9yT2JqID0gbmV3IEVycm9yKCdTb21ldGhpbmcgd2VudCB3cm9uZyEnKTtcbiAgICAgICAgZXJyb3JPYmouc3RhdHVzQ29kZSA9IHJlc3BvbnNlLnN0YXR1cyB8fCA1MDA7XG4gICAgICAgIGVycm9yT2JqLmVycm9yID0gJ0Vycm9yJztcbiAgICAgICAgdGhyb3cgZXJyb3JPYmo7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXhlYykge1xuICAgICAgY29uc29sZS5sb2coJ0VSUk9SID4gR0VORVJBVElORyBQQUlSSU5HIFRPS0VOID4gJywgZXhlYyk7XG4gICAgICB0aHJvdyBleGVjO1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0IGdldEFjY2Vzc1Rva2VuID0gYXN5bmMgKHBhaXJpbmdUb2tlbiwgb3B0aW9ucyA9IHt9KSA9PiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGFzeW5jIChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGlmICghcGFpcmluZ1Rva2VuKSB7XG4gICAgICAgICAgbGV0IHJlc3AgPSBhd2FpdCB0aGlzLmdlbmVyYXRlUGFpcmluZ1Rva2VuKG9wdGlvbnMpO1xuICAgICAgICAgIHBhaXJpbmdUb2tlbiA9IHJlc3AudG9rZW47XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBjaGVja1BvbGxpbmdVcmwgPSBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGxldCByZXNwID0gYXdhaXQgcG9sbGluZ1VybChwYWlyaW5nVG9rZW4sIG9wdGlvbnMpO1xuICAgICAgICAgICAgaWYgKHJlc3AucmVzdWx0ICYmIHJlc3AucmVzdWx0ID09ICdvaycpIHtcbiAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLmludGVydmFsSW5zdGFuY2UpO1xuICAgICAgICAgICAgICByZXNvbHZlKHJlc3ApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gY2F0Y2ggKGV4ZWMpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0VSUk9SID4gR0VUVElORyBBQ0NFU1MgVE9LRU4gPiAnKTtcbiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5pbnRlcnZhbEluc3RhbmNlKTtcbiAgICAgICAgICAgIHJlamVjdChleGVjKTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKCFzdG9wUG9sbGluZykge1xuICAgICAgICAgIHRoaXMuaW50ZXJ2YWxJbnN0YW5jZSA9IHNldEludGVydmFsKGNoZWNrUG9sbGluZ1VybCwgMiAqIDEwMDApO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChleGVjKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdFUlJPUiA+IEdFVFRJTkcgQUNDRVNTIFRPS0VOID4gJywgZXhlYyk7XG4gICAgICAgIHJlamVjdChleGVjKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIGNvbnN0IHBvbGxpbmdVcmwgPSBhc3luYyAocGFpcmluZ1Rva2VuLCBvcHRpb25zID0ge30pID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgQVBJX1VSTCA9IGAke3dpbmRvdy5BUElfVVJMfS9ycGMvcGFpcmluZ190b2tlbj90PSR7cGFpcmluZ1Rva2VufWA7XG5cbiAgICAgIGNvbnN0IHJlcU9iaiA9IHtcbiAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAgIH0sXG4gICAgICB9O1xuXG4gICAgICBpZiAob3B0aW9ucy5oZWFkZXJzKSB7XG4gICAgICAgIHJlcU9iai5oZWFkZXJzID0gT2JqZWN0LmFzc2lnbihyZXFPYmouaGVhZGVycywgb3B0aW9ucy5oZWFkZXJzKTtcbiAgICAgIH1cblxuICAgICAgbGV0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goQVBJX1VSTCwgcmVxT2JqKTtcbiAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT0gMjAwKSB7XG4gICAgICAgIGxldCBqc29uID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgICAgICByZXR1cm4ganNvbjtcbiAgICAgIH1cbiAgICAgIGxldCBqc29uID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgICAgaWYgKGpzb24uZXJyb3IpIHtcbiAgICAgICAgbGV0IGVycm9yT2JqID0gbmV3IEVycm9yKGpzb24uZGVzY3JpcHRpb24gfHwgJ1NvbWV0aGluZyB3ZW50IHdyb25nIScpO1xuICAgICAgICBlcnJvck9iai5zdGF0dXNDb2RlID0ganNvbi5zdGF0dXNfY29kZSB8fCByZXNwb25zZS5zdGF0dXMgfHwgNTAwO1xuICAgICAgICBpZiAoZXJyb3JPYmouc3RhdHVzQ29kZSA9PSA0MDQpIHtcbiAgICAgICAgICBlcnJvck9iai5tZXNzYWdlID0gJ0ZhaWxlZCB0byBwYWlyLiBQbGVhc2UgdHJ5IGFnYWluISc7XG4gICAgICAgIH1cbiAgICAgICAgZXJyb3JPYmouZXJyb3IgPSBqc29uLmVycm9yIHx8ICdFcnJvcic7XG4gICAgICAgIHRocm93IGVycm9yT2JqO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbGV0IGVycm9yT2JqID0gbmV3IEVycm9yKCdTb21ldGhpbmcgd2VudCB3cm9uZyEnKTtcbiAgICAgICAgZXJyb3JPYmouc3RhdHVzQ29kZSA9IHJlc3BvbnNlLnN0YXR1cyB8fCA1MDA7XG4gICAgICAgIGlmIChlcnJvck9iai5zdGF0dXNDb2RlID09IDQwNCkge1xuICAgICAgICAgIGVycm9yT2JqLm1lc3NhZ2UgPSAnRmFpbGVkIHRvIHBhaXIuIFBsZWFzZSB0cnkgYWdhaW4hJztcbiAgICAgICAgfVxuICAgICAgICBlcnJvck9iai5lcnJvciA9ICdFcnJvcic7XG4gICAgICAgIHRocm93IGVycm9yT2JqO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGV4ZWMpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdFUlJPUiA+IEdFTkVSQVRJTkcgQVVUSCBVUkwgPiAnLCBleGVjKTtcbiAgICAgIHRocm93IGV4ZWM7XG4gICAgfVxuICB9XG5cblxuY2hyb21lLnRhYnMub25SZW1vdmVkLmFkZExpc3RlbmVyKCh0YWJJZCkgPT4gey8vY2hlY2sgaWYgdGhlIHRhYiBkZWxldGVkXG4gIGNoZWNrSWZUYWJVcGRhdGVkMSh0YWJJZClcbn0pO1xuXG5jaHJvbWUudGFicy5vblVwZGF0ZWQuYWRkTGlzdGVuZXIoKHRhYklkKSA9PiB7Ly9jaGVjayBpZiB0aGUgdGFiIHVwZGF0ZWRcbiAgY2hlY2tJZlRhYlVwZGF0ZWQxKHRhYklkKVxufSk7XG5cbmZ1bmN0aW9uIGNoZWNrSWZUYWJVcGRhdGVkMSh0YWJJZCl7Ly9pZiB0aGUgdGFiIGRlbGV0ZWQgb3IgdXBkYXRlZCBzdG9wIHRoZSBwb2xsaW5nXG4gIGxldCBmaW5kSWZSZWZyZXNoZWQgPSBjaGVja1RhYnNBcmVVcGRhdGVPclJlbW92ZWQuZmluZChmaW5kVGFiPT5maW5kVGFiPT09dGFiSWQpXG4gIGlmKGZpbmRJZlJlZnJlc2hlZCl7XG4gICAgY2xlYXJJbnRlcnZhbCh0aGlzLmludGVydmFsSW5zdGFuY2UpXG4gIH1cbn0gXG4iLCJsZXQgc2VuZEZpcnN0SW5zdGFsbEV2ZW50ID0gZmFsc2VcbmNocm9tZS5ydW50aW1lLm9uTWVzc2FnZS5hZGRMaXN0ZW5lcigobWVzc2FnZSwgc2VuZGVyLCBzZW5kUmVzcG9uc2UpID0+IHtcbiAgICBpZihtZXNzYWdlLmFwaSA9PT0gJ3RyYWNrRXZlbnQnKXtcbiAgICAgICAgaWYoc2VuZGVyICYmIHNlbmRlci5vcmlnaW4gJiYgdHlwZW9mIHNlbmRlci5vcmlnaW4gPT09ICdzdHJpbmcnICYmIHNlbmRlci5vcmlnaW4uaW5jbHVkZXMoJy5maWdtYS4nKSl7XG4gICAgICAgICAgbGV0IHBhcmFtcyA9IG1lc3NhZ2UucGFyYW1zID8gbWVzc2FnZS5wYXJhbXMgOiB7fVxuICAgICAgICAgIHNlbmRUcmFja0V2ZW50KG1lc3NhZ2UuZXZlbnROYW1lLCBtZXNzYWdlLnVzZXJJZCwgbWVzc2FnZS51c2VyRW1haWwsIHBhcmFtcylcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIGlmKG1lc3NhZ2UuYXBpID09PSAnZmlyc3RSZWZyZXNoJyl7XG4gICAgICBVVUlEID0gbWVzc2FnZS5VVUlEXG5cbiAgICAgIGlmKHNlbmRGaXJzdEluc3RhbGxFdmVudCl7XG4gICAgICAgIHNlbmRGaXJzdEluc3RhbGxFdmVudCA9IGZhbHNlXG4gICAgICAgIHNldFRpbWVvdXQoKCk9PntcbiAgICAgICAgICBzZW5kVHJhY2tFdmVudCgnY2hyb21lLmV4dGVuc2lvbi5pbnN0YWxsZWQnLCAnJywgJycpXG4gICAgICAgIH0sNTAwMClcbiAgICAgIH1cbiAgICB9ICAgIFxuICAgIGVsc2UgaWYobWVzc2FnZS5hcGkgPT09ICdhbGlhcycpe1xuICAgICAgICBhbGlhcyhtZXNzYWdlLnVzZXJJZCwgbWVzc2FnZS5lbWFpbClcbiAgICB9XG4gICAgcmV0dXJuIHRydWVcbn0pO1xuXG5sZXQgdHJhY2tpbmdDbGFzc1xuZnVuY3Rpb24gc2VuZFRyYWNrRXZlbnQoZXZlbnROYW1lLCB1c2VySWQsIHVzZXJFbWFpbCwgcGFyYW1zID0ge30pe1xuICAgIHVzZXJJZCA9IFVVSUQvL3VzZXJJZCA/IHVzZXJJZCA6IFVVSURcbiAgICBcbiAgICB2YXIgYXJncyA9IHtcbiAgICAgICAgZXZlbnRDYXRlZ29yeTogJ0dlbmVyYWwnLFxuICAgICAgICBldmVudEFjdGlvbjogZXZlbnROYW1lID8gZXZlbnROYW1lIDogJycsXG4gICAgICAgIHVpZDogdXNlcklkLFxuICAgIH07XG4gICAgXG4gICAgcGFyYW1zLmV4dGVuc2lvbk5hbWUgPSB3aW5kb3cuZXh0ZW5zaW9uTmFtZVxuICAgIGFyZ3NbJ3BhcmFtcyddID0gSlNPTi5zdHJpbmdpZnkocGFyYW1zKTtcbiAgICBcbiAgICB2YXIgZGF0YSA9IHBhcmFtZXRpemUoYXJncyk7XG4gICAgdmFyIGh0dHAgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICB2YXIgdXJsID0gJ2h0dHBzOi8vbG9ncy5hbmltYWFwcC5jb20vYW5hbHl0aWNzL2NvbGxlY3QnO1xuICAgIGh0dHAub3BlbignUE9TVCcsIHVybCwgdHJ1ZSk7XG5cbiAgICBodHRwLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtdHlwZScsICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnKTtcbiAgICAvLyBodHRwLnNldFJlcXVlc3RIZWFkZXIoJ1gtVXNlci1JZCcsIHVzZXJJZCA/IHVzZXJJZCA6ICcnKTtcbiAgICBodHRwLnNldFJlcXVlc3RIZWFkZXIoJ1gtVXNlci1FbWFpbCcsIHVzZXJFbWFpbCA/IHVzZXJFbWFpbCA6ICcnKTtcbiAgICBodHRwLnNldFJlcXVlc3RIZWFkZXIoJ1gtQ2xpZW50LUlkJywgJ2NvbS5hbmltYWFwcC5jaHJvbWUuZXh0ZW5zaW9uJyk7XG4gICAgLy8gaHR0cC5zZXRSZXF1ZXN0SGVhZGVyKCdYLUNsaWVudC1JZCcsICdjb20uYW5pbWFhcHAuZmlnbWEnKTtcbiAgICBodHRwLnNldFJlcXVlc3RIZWFkZXIoJ1gtQ2xpZW50LVZlcnNpb24nLCAnMS4wLjAnKTtcbiAgICBodHRwLnNlbmQoZGF0YSk7XG4gICAgXG4gICAgZnVuY3Rpb24gcGFyYW1ldGl6ZShvYmplY3QpIHtcbiAgICAgIHZhciBlbmNvZGVkU3RyaW5nID0gJyc7XG4gICAgICBmb3IgKHZhciBwcm9wIGluIG9iamVjdCkge1xuICAgICAgICBpZiAob2JqZWN0Lmhhc093blByb3BlcnR5KHByb3ApKSB7XG4gICAgICAgICAgaWYgKGVuY29kZWRTdHJpbmcubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgZW5jb2RlZFN0cmluZyArPSAnJic7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVuY29kZWRTdHJpbmcgKz0gZW5jb2RlVVJJKHByb3AgKyAnPScgKyBvYmplY3RbcHJvcF0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gZW5jb2RlZFN0cmluZztcbiAgICB9XG59XG5cblxubGV0IFVVSUQgPSBudWxsXG4vLyBmdW5jdGlvbiBjcmVhdGVVVUlEKCl7XG4vLyAgICAgd2luZG93LmNocm9tZS5zdG9yYWdlLnN5bmMuZ2V0KCd1c2VyVVVJRCcsKGRhdGEpPT57XG4vLyAgICAgICAgIGlmKGRhdGEgJiYgZGF0YS51c2VyVVVJRCAmJiBkYXRhLnVzZXJVVUlELmlkKXtcbi8vICAgICAgICAgICAgIFVVSUQgPSBkYXRhLnVzZXJVVUlELmlkXG4vLyAgICAgICAgIH1cbi8vICAgICAgICAgZWxzZXtcbi8vICAgICAgICAgICAgIFVVSUQgPSBnZW5lcmF0ZU5ld1VVSUQoKVxuLy8gICAgICAgICAgICAgd2luZG93LmNocm9tZS5zdG9yYWdlLnN5bmMuc2V0KHt1c2VyVVVJRDp7aWQ6VVVJRH19KVxuLy8gICAgICAgICAgICAgaWYoc2VuZEZpcnN0SW5zdGFsbEV2ZW50KXtcbi8vICAgICAgICAgICAgICAgc2VuZEZpcnN0SW5zdGFsbEV2ZW50ID0gZmFsc2Vcbi8vICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKT0+e1xuLy8gICAgICAgICAgICAgICAgIHNlbmRUcmFja0V2ZW50KCdjaHJvbWUuZXh0ZW5zaW9uLmluc3RhbGxlZCcsICcnLCAnJylcbi8vICAgICAgICAgICAgICAgfSw1MDAwKVxuLy8gICAgICAgICAgICAgfVxuLy8gICAgICAgICB9XG4vLyAgICAgfSlcbi8vIH1cblxuY2hyb21lLnJ1bnRpbWUub25JbnN0YWxsZWQuYWRkTGlzdGVuZXIoZnVuY3Rpb24oZGV0YWlscyl7XG4gIGlmKGRldGFpbHMucmVhc29uID09IFwiaW5zdGFsbFwiKXtcbiAgICBzZW5kRmlyc3RJbnN0YWxsRXZlbnQgPSB0cnVlXG4gIH1cbn0pO1xuXG5mdW5jdGlvbiBnZW5lcmF0ZU5ld1VVSUQoKSB7XG4gICAgdmFyIGQgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgICBpZiAoXG4gICAgICB0eXBlb2YgcGVyZm9ybWFuY2UgIT09IFwidW5kZWZpbmVkXCIgJiZcbiAgICAgIHR5cGVvZiBwZXJmb3JtYW5jZS5ub3cgPT09IFwiZnVuY3Rpb25cIlxuICAgICkge1xuICAgICAgZCArPSBwZXJmb3JtYW5jZS5ub3coKTsgLy91c2UgaGlnaC1wcmVjaXNpb24gdGltZXIgaWYgYXZhaWxhYmxlXG4gICAgfVxuICAgIHJldHVybiBcInh4eHh4eHh4LXh4eHgtNHh4eC15eHh4LXh4eHh4eHh4eHh4eFwiLnJlcGxhY2UoXG4gICAgICAvW3h5XS9nLFxuICAgICAgZnVuY3Rpb24oYykge1xuICAgICAgICB2YXIgciA9IChkICsgTWF0aC5yYW5kb20oKSAqIDE2KSAlIDE2IHwgMDtcbiAgICAgICAgZCA9IE1hdGguZmxvb3IoZCAvIDE2KTtcbiAgICAgICAgcmV0dXJuIChjID09PSBcInhcIiA/IHIgOiAociAmIDB4MykgfCAweDgpLnRvU3RyaW5nKDE2KTtcbiAgICAgIH1cbiAgICApO1xufVxuXG5hc3luYyBmdW5jdGlvbiBhbGlhcyh1c2VySWQsIHVzZXJFbWFpbCkge1xuICAgIGlmIChVVUlEICYmIHVzZXJJZCkge1xuICAgICAgY29uc3QgYXJncyA9IHtcbiAgICAgICAgYWxpYXM6IHVzZXJJZCwvL3RoZSB1c2VyIGlkIGZyb20gZGJcbiAgICAgICAgZGlzdGluY3RfaWQ6VVVJRCwgLy90aGUgb2xkIHVzZXIgaWRcbiAgICAgIH07XG4gICAgICBcbiAgICAgIHRyeSB7XG4gICAgICAgIGxldCB1cmwgPSBgaHR0cHM6Ly9sb2dzLmFuaW1hYXBwLmNvbS9hbmFseXRpY3MvcmVnaXN0ZXJfYWxpYXNgO1xuICAgICAgICBsZXQgcmVzID0gYXdhaXQgc2VuZFJlcXVlc3QodXJsLCBhcmdzLCB1c2VySWQsIHVzZXJFbWFpbCk7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdyZWdpc3Rlcl9hbGlhcyBmYWlsZWQnLCBlKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBzZW5kUmVxdWVzdCh1cmwsIGFyZ3MsIHVzZXJJZCwgdXNlckVtYWlsKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZWplY3QsIHJlc29sdmUpID0+IHtcbiAgICAgIGNvbnN0IGRhdGEgPSBwYXJhbWV0ZXJpemUoYXJncyk7XG5cbiAgICAgIGNvbnN0IGh0dHAgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICAgIFxuICAgICAgaHR0cC5vcGVuKCdQT1NUJywgdXJsLCB0cnVlKTtcbiAgICAgIGh0dHAuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC10eXBlJywgJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCcpO1xuICAgICAgaHR0cC5zZXRSZXF1ZXN0SGVhZGVyKCdYLVVzZXItSWQnLCB1c2VySWQgPyB1c2VySWQgOiAnJyk7XG4gICAgICBodHRwLnNldFJlcXVlc3RIZWFkZXIoJ1gtVXNlci1FbWFpbCcsIHVzZXJFbWFpbCA/IHVzZXJFbWFpbCA6ICcnKTtcbiAgICAgIGh0dHAuc2V0UmVxdWVzdEhlYWRlcignWC1DbGllbnQtSWQnLCAnY29tLmFuaW1hYXBwLmNocm9tZS5leHRlbnNpb24nKTtcbiAgICAgIGh0dHAuc2V0UmVxdWVzdEhlYWRlcignWC1DbGllbnQtVmVyc2lvbicsICcxLjAuMCcpO1xuXG5cbiAgICAgIGZvciAoY29uc3QgaCBpbiB0aGlzLmhlYWRlcnMpIHtcbiAgICAgICAgY29uc3QgdiA9IHRoaXMuaGVhZGVyc1toXTtcbiAgICAgICAgaHR0cC5zZXRSZXF1ZXN0SGVhZGVyKGgsIHYpO1xuICAgICAgfVxuXG4gICAgICBodHRwLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGh0dHAucmVhZHlTdGF0ZSA9PT0gNCAmJiBodHRwLnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICAgICAgcmVzb2x2ZShodHRwLnJlc3BvbnNlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZWplY3Qoe1xuICAgICAgICAgICAgc3RhdHVzOiBodHRwLnN0YXR1cyxcbiAgICAgICAgICAgIHN0YXR1c1RleHQ6IGh0dHAuc3RhdHVzVGV4dCxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgaHR0cC5vbmVycm9yID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZWplY3Qoe1xuICAgICAgICAgIHN0YXR1czogaHR0cC5zdGF0dXMsXG4gICAgICAgICAgc3RhdHVzVGV4dDogaHR0cC5zdGF0dXNUZXh0LFxuICAgICAgICB9KTtcbiAgICAgIH07XG5cbiAgICAgIGh0dHAuc2VuZChkYXRhKTtcbiAgICB9KTtcbiAgfVxuXG4gIGNvbnN0IHBhcmFtZXRlcml6ZSA9IChvYmopID0+IHtcbiAgICBsZXQgZW5jb2RlZFN0cmluZyA9ICcnO1xuICAgIGZvciAobGV0IHByb3AgaW4gb2JqKSB7XG4gICAgICBpZiAob2JqLmhhc093blByb3BlcnR5KHByb3ApKSB7XG4gICAgICAgIGlmIChlbmNvZGVkU3RyaW5nLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBlbmNvZGVkU3RyaW5nICs9ICcmJztcbiAgICAgICAgfVxuICAgICAgICBlbmNvZGVkU3RyaW5nICs9IGVuY29kZVVSSShwcm9wICsgJz0nICsgb2JqW3Byb3BdKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGVuY29kZWRTdHJpbmc7XG4gIH07Il0sInNvdXJjZVJvb3QiOiIifQ==